function setDoom(){$(".ui-form-list-btn").parent().hide(),$("#basketArea").find(".ui-scroll").attr("style","height:"+50*window.innerHeight/100+"px;max"),$("#scrollbarProject").attr("style","margin-bottom:0;overflow-y:hidden"),document.body.addEventListener("click",hideP),0==generalParamsSatis.workingParams.SHOW_HYDROLIC&&$("#hydBtn").hide(),0==generalParamsSatis.workingParams.SHOW_PUMP&&$("#pumpBtn").hide(),0==generalParamsSatis.workingParams.SHOW_TUBE&&$("#hoseBtn").hide(),0==generalParamsSatis.workingParams.SHOW_VIRTUAL_PRODUCT&&$("#vpBtn").hide(),FiyatTalepKontrol(0)}function hideP(){$(".pbsContex").remove()}function AddRow(t,e,a,r,n,i,o,d,u,l,c=0,s="",_="TL",m,p="-6",A=0,v=0,E="Adet",b="",C="",I=0,T="",y="",P=0,h="",w="",D="",S=0,O=0,g=0,f=0,R=0){if(1==g)return getKarmaProducts(t,i),!1;if(1==O&&0==g){var N=" SELECT SUM (FIY) as FIYATIM FROM ( SELECT *,CASE WHEN 1="+R+" THEN SALES_PRICE* PRODUCT_AMOUNT WHEN HVT=0 THEN workcube_metosan_1.NT_GET_CURRENT_PRODUCT_PRICE("+CompanyData.COMPANY_ID+","+CompanyData.PRICE_CAT+",STOCK_ID)*PRODUCT_AMOUNT ELSE workcube_metosan_1.GET_CURRENT_PRODUCT_PRICE("+CompanyData.COMPANY_ID+","+CompanyData.PRICE_CAT+",STOCK_ID)*PRODUCT_AMOUNT END AS FIY FROM (";N+=" SELECT STOCK_ID,PRODUCT_AMOUNT,SALES_PRICE,(SELECT COUNT(*) FROM workcube_metosan_1.PRODUCT_TREE WHERE STOCK_ID=KARMA_PRODUCTS.STOCK_ID) AS HVT  FROM workcube_metosan_product.KARMA_PRODUCTS WHERE KARMA_PRODUCT_ID="+t+"   ) AS T ) AS TK";var B=wrk_query(N,"DSN3");console.log(B),o=B.FIYATIM[0],m=B.FIYATIM[0]}console.log(arguments);var x=$(document),k=x.find("input[name=_rd_money]:checked").val();document.getElementById("_hidden_rd_money_"+k).value;if(0==f&&"M"==E&&0==I){var L="&pid_="+t+"&sid_="+e+"&tax="+u+"&cost="+v+"&manuel="+A+"&product_name="+d+"&stock_code="+a+"&brand="+r+"&indirim1="+l+"&amount="+i+"&unit="+E+"&price="+o+"&other_money="+_+"&price_other="+m;return L+="&is_virtual="+n,L+="&product_type="+c,L+="&shelf_code="+s,L+="&rowNum="+row_count,openBoxDraggable("index.cfm?fuseaction=objects.emptypopup_extra_calculate_pbs"+L),!0}var U="SELECT PP.SHELF_CODE  FROM PRODUCT_PLACE_ROWS AS PPR";U+=" LEFT JOIN PRODUCT_PLACE AS PP ON PP.PRODUCT_PLACE_ID=PPR.PRODUCT_PLACE_ID",U+=" LEFT JOIN "+generalParamsSatis.dataSources.dsn+".DEPARTMENT AS D ON D.DEPARTMENT_ID=PP.STORE_ID",U+=" WHERE STOCK_ID="+e+" AND D.BRANCH_ID IN (SELECT D.BRANCH_ID FROM "+generalParamsSatis.dataSources.dsn+".EMPLOYEE_POSITIONS AS EP INNER JOIN "+generalParamsSatis.dataSources.dsn+".DEPARTMENT AS D ON D.DEPARTMENT_ID =EP.DEPARTMENT_ID WHERE EP.POSITION_CODE=EP.POSITION_CODE)";var M=wrk_query(U,"dsn3"),F="";if(0==s.length){if(M.recordcount>0){if(M.recordcount>1&&0==I){L="&pid_="+t+"&sid_="+e+"&tax="+u+"&cost="+v+"&manuel="+A+"&product_name="+d+"&stock_code="+a+"&brand="+r+"&indirim1="+l+"&amount="+i+"&unit="+E+"&price="+o+"&other_money="+_+"&price_other="+m;return L+="&is_virtual="+n,L+="&product_type="+c,L+="&shelf_code="+s,L+="&rowNum="+row_count,openBoxDraggable("index.cfm?fuseaction=objects.emptypopup_select_raf_pbs"+L),!0}F=M.SHELF_CODE[0]}}else F=s;row_count++,rowCount=row_count;var Y=moneyArr.find(t=>t.MONEY==_),H=m*Y.RATE2;if(0==o){U="SELECT ISNULL("+generalParamsSatis.dataSources.dsn3+".GET_CURRENT_PRODUCT_PRICE("+CompanyData.COMPANY_ID+","+CompanyData.PRICE_CAT+","+e+"),0) AS FIYAT",M=wrk_query(U,"dsn3");H=M.FIYAT[0],o=M.FIYAT[0],m=M.FIYAT[0],_="TL"}var K=document.createElement("tr");1==A&&K.setAttribute("style","background-color:#86b5ff75 !important;"),K.setAttribute("id","row_"+row_count),K.setAttribute("data-selected","0"),K.setAttribute("data-rc",row_count),K.setAttribute("data-ProductType",c),K.setAttribute("class","sepetRow");var q=document.createElement("td"),G=document.createElement("span");G.innerText=row_count,G.setAttribute("id","spn_"+row_count),q.appendChild(G);var W=document.createElement("span");1!=row_count?(W.setAttribute("class","fa fa-arrow-up"),W.setAttribute("onclick","moveRow("+row_count+","+(row_count-1)+")")):W.setAttribute("class",""),q.appendChild(W),K.appendChild(q);q=document.createElement("td");var j=document.createElement("input");j.setAttribute("type","checkbox"),j.setAttribute("data-row",row_count),j.setAttribute("onclick","selectrw(this)"),q.appendChild(j),K.appendChild(q);q=document.createElement("td");var J=document.createElement("input");J.setAttribute("name","product_id_"+row_count),J.setAttribute("id","product_id_"+row_count),J.setAttribute("type","hidden"),J.setAttribute("value",t);var V=document.createElement("input");V.setAttribute("name","stock_id_"+row_count),V.setAttribute("id","stock_id_"+row_count),V.setAttribute("type","hidden"),V.setAttribute("value",e);var X=document.createElement("input");X.setAttribute("name","is_virtual_"+row_count),X.setAttribute("id","is_virtual_"+row_count),X.setAttribute("type","hidden"),X.setAttribute("value",n);var z=document.createElement("input");z.setAttribute("name","shelf_code_"+row_count),z.setAttribute("id","shelf_code_"+row_count),z.setAttribute("type","hidden"),z.setAttribute("value",F);var Q=document.createElement("input");Q.setAttribute("name","cost_"+row_count),Q.setAttribute("id","cost_"+row_count),Q.setAttribute("type","hidden"),Q.setAttribute("value",v);var Z=document.createElement("input");Z.setAttribute("name","is_karma_"+row_count),Z.setAttribute("id","is_karma_"+row_count),Z.setAttribute("type","hidden"),Z.setAttribute("value",O);var tt=document.createElement("input");tt.setAttribute("name","is_production_"+row_count),tt.setAttribute("id","is_production_"+row_count),tt.setAttribute("type","hidden"),tt.setAttribute("value",P);var et=document.createElement("input");if(et.setAttribute("name","row_uniq_id_"+row_count),et.setAttribute("id","row_uniq_id_"+row_count),et.setAttribute("type","hidden"),h.length>0)et.setAttribute("value",h);else{var at=GenerateUniqueId();et.setAttribute("value",at)}var rt=document.createElement("input");rt.setAttribute("name","is_manuel_"+row_count),rt.setAttribute("id","is_manuel_"+row_count),rt.setAttribute("type","hidden"),rt.setAttribute("value",A),q.appendChild(J),q.appendChild(V),q.appendChild(X),q.appendChild(z),q.appendChild(Q),q.appendChild(Z),q.appendChild(tt),q.appendChild(et),q.appendChild(rt);z=document.createElement("input");z.setAttribute("name","stock_code_"+row_count),z.setAttribute("id","stock_code_"+row_count),z.setAttribute("type","text"),z.setAttribute("readonly",""),z.setAttribute("style","width:40px"),z.setAttribute("class","stockkodu"),z.setAttribute("value",a);var nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(z),q.appendChild(nt),K.appendChild(q);q=document.createElement("td");q.setAttribute("style","width:15%");z=document.createElement("input");z.setAttribute("name","product_name_"+row_count),z.setAttribute("id","product_name_"+row_count),z.setAttribute("class","urunadi"),z.setAttribute("type","text"),z.setAttribute("style","width:40px"),z.setAttribute("value",d);nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(z),q.appendChild(nt),K.appendChild(q);q=document.createElement("td");q.setAttribute("style","width:5%");z=document.createElement("input");z.setAttribute("name","brand_name_"+row_count),z.setAttribute("id","brand_name_"+row_count),z.setAttribute("type","text"),z.setAttribute("disabled",""),z.setAttribute("value",r);nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(z),q.appendChild(nt),K.appendChild(q);var it=getRafSml(e,F);q=document.createElement("td");q.setAttribute("style","width:5%");z=document.createElement("input");z.setAttribute("name","department_name"+row_count),z.setAttribute("id","department_name"+row_count),z.setAttribute("type","text"),z.setAttribute("disabled",""),z.setAttribute("value",it);nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(z),q.appendChild(nt),K.appendChild(q);q=document.createElement("td");q.setAttribute("style","display:flex;align-items: baseline;");nt=document.createElement("div");nt.setAttribute("class","form-group");var ot=AsamaYapici(row_count,p),dt=document.createElement("span");dt.setAttribute("class","icon-detail"),dt.setAttribute("onclick","openBoxDraggable('index.cfm?fuseaction=objects.popup_detail_product&pid="+t+"&sid="+e+"')"),nt.appendChild(ot),q.appendChild(nt),1!=n&&q.appendChild(dt),K.appendChild(q);q=document.createElement("td");q.setAttribute("style","width:3%");Q=document.createElement("input");Q.setAttribute("name","amount_"+row_count),Q.setAttribute("id","amount_"+row_count),Q.setAttribute("type","text"),Q.setAttribute("class","prtMoneyBox"),Q.setAttribute("value",commaSplit(i,2)),Q.setAttribute("onchange","hesapla('price',"+row_count+")"),Q.setAttribute("onClick","sellinputAllVal(this)");nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(Q),q.appendChild(nt),K.appendChild(q);q=document.createElement("td");q.setAttribute("style","width:3%");Q=document.createElement("input");Q.setAttribute("name","main_unit_"+row_count),Q.setAttribute("id","main_unit_"+row_count),Q.setAttribute("type","text"),Q.setAttribute("style","width:20px"),Q.setAttribute("readonly",""),Q.setAttribute("value",E);nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(Q),q.appendChild(nt),K.appendChild(q);q=document.createElement("td");q.setAttribute("style","width:3%");var ut=document.createElement("select");ut.setAttribute("name","other_money_"+row_count),ut.setAttribute("id","other_money_"+row_count),ut.setAttribute("onchange","hesapla('other_money',"+row_count+")");for(let t=0;t<moneyArr.length;t++){const e=moneyArr[t];var lt=document.createElement("option");lt.setAttribute("value",e.MONEY),lt.innerText=e.MONEY,ut.appendChild(lt)}ut.value=_;nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(ut),q.appendChild(nt),K.appendChild(q);q=document.createElement("td");q.setAttribute("style","width:5%");var ct=document.createElement("input");ct.setAttribute("name","price_other_"+row_count),ct.setAttribute("id","price_other_"+row_count),ct.setAttribute("type","text"),ct.setAttribute("onchange","hesapla('price_other',"+row_count+")"),ct.setAttribute("class","prtMoneyBox"),ct.setAttribute("style","width:30px"),ct.setAttribute("value",commaSplit(m,FiyatYuvarlama));nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(ct),q.appendChild(nt),K.appendChild(q);q=document.createElement("td");q.setAttribute("style","width:5%");tt=document.createElement("input");tt.setAttribute("name","price_"+row_count),tt.setAttribute("id","price_"+row_count),tt.setAttribute("type","text"),tt.setAttribute("onchange","hesapla('price',"+row_count+")"),tt.setAttribute("onClick","sellinputAllVal(this)"),tt.setAttribute("class","prtMoneyBox"),tt.setAttribute("style","width:30px"),tt.setAttribute("value",commaSplit(H,FiyatYuvarlama));nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(tt),q.appendChild(nt),K.appendChild(q);q=document.createElement("td");q.setAttribute("style","width:5%");var st=document.createElement("input");st.setAttribute("name","indirim1_"+row_count),st.setAttribute("id","indirim1_"+row_count),st.setAttribute("value",commaSplit(l)),st.setAttribute("type","text"),st.setAttribute("onchange","getSetNum(this)&hesapla('price',"+row_count+")"),st.setAttribute("class","prtMoneyBox");nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(st),q.appendChild(nt),K.appendChild(q);q=document.createElement("td");q.setAttribute("style","width:10%");var _t=document.createElement("input");_t.setAttribute("name","row_nettotal_"+row_count),_t.setAttribute("id","row_nettotal_"+row_count),_t.setAttribute("type","text"),_t.setAttribute("class","prtMoneyBox"),_t.setAttribute("value",commaSplit(0,Yuvarlama));nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(_t),q.appendChild(nt),K.appendChild(q);q=document.createElement("td");q.setAttribute("style","width:15%");z=document.createElement("input");z.setAttribute("name","product_name_other_"+row_count),z.setAttribute("id","product_name_other_"+row_count),z.setAttribute("type","text"),z.setAttribute("style","width:40px"),z.setAttribute("value",b);nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(z),q.appendChild(nt),K.appendChild(q);q=document.createElement("td");q.setAttribute("style","width:8%");z=document.createElement("input");z.setAttribute("name","detail_info_extra_"+row_count),z.setAttribute("id","detail_info_extra_"+row_count),z.setAttribute("type","text"),z.setAttribute("style","width:40px"),z.setAttribute("value",C);nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(z),q.appendChild(nt),K.appendChild(q);var mt=new Date;q=document.createElement("td");q.setAttribute("style","width:10%");z=document.createElement("input");z.setAttribute("name","deliver_date_"+row_count),z.setAttribute("id","deliver_date_"+row_count),z.setAttribute("type","date"),y.length>0?z.setAttribute("value",y):z.setAttribute("value",mt.toISOString().split("T")[0]);nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(z),q.appendChild(nt),K.appendChild(q);q=document.createElement("td");q.setAttribute("style","display:none"),q.setAttribute("class","hiddenR");var pt=document.createElement("input");pt.setAttribute("name","Tax_"+row_count),pt.setAttribute("id","Tax_"+row_count),pt.setAttribute("value",commaSplit(u));var At=document.createElement("input");At.setAttribute("name","converted_sid_"+row_count),At.setAttribute("id","converted_sid_"+row_count),At.setAttribute("value",S);nt=document.createElement("div");nt.setAttribute("class","form-group"),nt.appendChild(pt),nt.appendChild(At),q.appendChild(nt),K.appendChild(q);q=document.createElement("td"),nt=document.createElement("div");nt.setAttribute("class","form-group");var vt=document.createElement("input");vt.setAttribute("name","description_"+row_count),vt.setAttribute("id","description_"+row_count),vt.setAttribute("value",w),nt.appendChild(vt),q.appendChild(nt),K.appendChild(q),rowaListener(K);var Et=document.getElementById("tbl_basket");Et.appendChild(K),hesapla("other_money",rowCount),manuelControl(),RowControlForVirtual()}function AddRow_pbso(t,e,a,r,n,i,o,d,u,l,c=0,s="",_="TL",m,p="-6",A=0,v=0,E="Adet",b="",C="",I=0,T="",y="",P=0,h="",w="",D="",S=0,O=0,g=0){console.log(arguments);var f=$(document),R=f.find("input[name=_rd_money]:checked").val();document.getElementById("_hidden_rd_money_"+R).value;if("M"==E&&0==I){var N="&pid_="+t+"&sid_="+e+"&tax="+u+"&cost="+v+"&manuel="+A+"&product_name="+d+"&stock_code="+a+"&brand="+r+"&indirim1="+l+"&amount="+i+"&unit="+E+"&price="+o+"&other_money="+_+"&price_other="+m;return N+="&is_virtual="+n,N+="&product_type="+c,N+="&shelf_code="+s,N+="&rowNum="+row_count,openBoxDraggable("index.cfm?fuseaction=objects.emptypopup_extra_calculate_pbs"+N),!0}var B="SELECT PP.SHELF_CODE  FROM PRODUCT_PLACE_ROWS AS PPR";B+=" LEFT JOIN PRODUCT_PLACE AS PP ON PP.PRODUCT_PLACE_ID=PPR.PRODUCT_PLACE_ID",B+=" LEFT JOIN "+generalParamsSatis.dataSources.dsn+".DEPARTMENT AS D ON D.DEPARTMENT_ID=PP.STORE_ID",B+=" WHERE STOCK_ID="+e+" AND D.BRANCH_ID IN (SELECT D.BRANCH_ID FROM "+generalParamsSatis.dataSources.dsn+".EMPLOYEE_POSITIONS AS EP INNER JOIN "+generalParamsSatis.dataSources.dsn+".DEPARTMENT AS D ON D.DEPARTMENT_ID =EP.DEPARTMENT_ID WHERE EP.POSITION_CODE=EP.POSITION_CODE)";var x="";if(0==s.length&&0!=e){var k=wrk_query(B,"dsn3");if(k.recordcount>0){if(k.recordcount>1&&0==I){N="&pid_="+t+"&sid_="+e+"&tax="+u+"&cost="+v+"&manuel="+A+"&product_name="+d+"&stock_code="+a+"&brand="+r+"&indirim1="+l+"&amount="+i+"&unit="+E+"&price="+o+"&other_money="+_+"&price_other="+m;return N+="&is_virtual="+n,N+="&product_type="+c,N+="&shelf_code="+s,N+="&rowNum="+row_count,openBoxDraggable("index.cfm?fuseaction=objects.emptypopup_select_raf_pbs"+N),!0}x=k.SHELF_CODE[0]}}else x=s;row_count++,rowCount=row_count;var L=moneyArr.find(t=>t.MONEY==_),U=m*L.RATE2;if(0==o){B="SELECT ISNULL("+generalParamsSatis.dataSources.dsn3+".GET_CURRENT_PRODUCT_PRICE("+CompanyData.COMPANY_ID+","+CompanyData.PRICE_CAT+","+e+"),0) AS FIYAT",k=wrk_query(B,"dsn3");U=k.FIYAT[0],o=k.FIYAT[0],m=k.FIYAT[0],_="TL"}var M=document.createElement("tr");1==A&&M.setAttribute("style","background-color:#86b5ff75 !important;"),M.setAttribute("id","row_"+row_count),M.setAttribute("data-selected","0"),M.setAttribute("data-rc",row_count),M.setAttribute("data-ProductType",c),M.setAttribute("class","sepetRow");var F=document.createElement("td"),Y=document.createElement("span");Y.innerText=row_count,Y.setAttribute("id","spn_"+row_count),F.appendChild(Y);var H=document.createElement("span");1!=row_count?(H.setAttribute("class","fa fa-arrow-up"),H.setAttribute("onclick","moveRow("+row_count+","+(row_count-1)+")")):H.setAttribute("class",""),F.appendChild(H),M.appendChild(F);F=document.createElement("td");var K=document.createElement("input");K.setAttribute("type","checkbox"),K.setAttribute("data-row",row_count),K.setAttribute("onclick","selectrw(this)"),F.appendChild(K),M.appendChild(F);F=document.createElement("td");var q=document.createElement("input");q.setAttribute("name","product_id_"+row_count),q.setAttribute("id","product_id_"+row_count),q.setAttribute("type","hidden"),q.setAttribute("value",t);var G=document.createElement("input");G.setAttribute("name","stock_id_"+row_count),G.setAttribute("id","stock_id_"+row_count),G.setAttribute("type","hidden"),G.setAttribute("value",e);var W=document.createElement("input");W.setAttribute("name","is_virtual_"+row_count),W.setAttribute("id","is_virtual_"+row_count),W.setAttribute("type","hidden"),W.setAttribute("value",n);var j=document.createElement("input");j.setAttribute("name","shelf_code_"+row_count),j.setAttribute("id","shelf_code_"+row_count),j.setAttribute("type","hidden"),j.setAttribute("value",x);var J=document.createElement("input");J.setAttribute("name","cost_"+row_count),J.setAttribute("id","cost_"+row_count),J.setAttribute("type","hidden"),J.setAttribute("value",v);var V=document.createElement("input");V.setAttribute("name","is_karma_"+row_count),V.setAttribute("id","is_karma_"+row_count),V.setAttribute("type","hidden"),V.setAttribute("value",O);var X=document.createElement("input");X.setAttribute("name","is_production_"+row_count),X.setAttribute("id","is_production_"+row_count),X.setAttribute("type","hidden"),X.setAttribute("value",P);var z=document.createElement("input");if(z.setAttribute("name","row_uniq_id_"+row_count),z.setAttribute("id","row_uniq_id_"+row_count),z.setAttribute("type","hidden"),h.length>0)z.setAttribute("value",h);else{var Q=GenerateUniqueId();z.setAttribute("value",Q)}var Z=document.createElement("input");Z.setAttribute("name","is_manuel_"+row_count),Z.setAttribute("id","is_manuel_"+row_count),Z.setAttribute("type","hidden"),Z.setAttribute("value",A),F.appendChild(q),F.appendChild(G),F.appendChild(W),F.appendChild(j),F.appendChild(J),F.appendChild(V),F.appendChild(X),F.appendChild(z),F.appendChild(Z);j=document.createElement("input");j.setAttribute("name","stock_code_"+row_count),j.setAttribute("id","stock_code_"+row_count),j.setAttribute("type","text"),j.setAttribute("readonly",""),j.setAttribute("style","width:40px"),j.setAttribute("class","stockkodu"),j.setAttribute("value",a);var tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(j),F.appendChild(tt),M.appendChild(F);F=document.createElement("td");F.setAttribute("style","width:15%");j=document.createElement("input");j.setAttribute("name","product_name_"+row_count),j.setAttribute("id","product_name_"+row_count),j.setAttribute("class","urunadi"),j.setAttribute("type","text"),j.setAttribute("style","width:40px"),j.setAttribute("value",d);tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(j),F.appendChild(tt),M.appendChild(F);F=document.createElement("td");F.setAttribute("style","width:5%");j=document.createElement("input");j.setAttribute("name","brand_name_"+row_count),j.setAttribute("id","brand_name_"+row_count),j.setAttribute("type","text"),j.setAttribute("disabled",""),j.setAttribute("value",r);tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(j),F.appendChild(tt),M.appendChild(F);var et=D;F=document.createElement("td");F.setAttribute("style","width:5%");j=document.createElement("input");j.setAttribute("name","department_name"+row_count),j.setAttribute("id","department_name"+row_count),j.setAttribute("type","text"),j.setAttribute("disabled",""),j.setAttribute("value",et);tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(j),F.appendChild(tt),M.appendChild(F);F=document.createElement("td");F.setAttribute("style","display:flex;align-items: baseline;");tt=document.createElement("div");tt.setAttribute("class","form-group");var at=AsamaYapici(row_count,p),rt=document.createElement("span");rt.setAttribute("class","icon-detail"),rt.setAttribute("onclick","openBoxDraggable('index.cfm?fuseaction=objects.popup_detail_product&pid="+t+"&sid="+e+"')"),tt.appendChild(at),F.appendChild(tt),1!=n&&F.appendChild(rt),M.appendChild(F);F=document.createElement("td");F.setAttribute("style","width:3%");J=document.createElement("input");J.setAttribute("name","amount_"+row_count),J.setAttribute("id","amount_"+row_count),J.setAttribute("type","text"),J.setAttribute("class","prtMoneyBox"),J.setAttribute("value",commaSplit(i,2)),J.setAttribute("onchange","hesapla('price',"+row_count+")"),J.setAttribute("onClick","sellinputAllVal(this)");tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(J),F.appendChild(tt),M.appendChild(F);F=document.createElement("td");F.setAttribute("style","width:3%");J=document.createElement("input");J.setAttribute("name","main_unit_"+row_count),J.setAttribute("id","main_unit_"+row_count),J.setAttribute("type","text"),J.setAttribute("style","width:20px"),J.setAttribute("readonly",""),J.setAttribute("value",E);tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(J),F.appendChild(tt),M.appendChild(F);F=document.createElement("td");F.setAttribute("style","width:3%");var nt=document.createElement("select");nt.setAttribute("name","other_money_"+row_count),nt.setAttribute("id","other_money_"+row_count),nt.setAttribute("onchange","hesapla('other_money',"+row_count+")");for(let t=0;t<moneyArr.length;t++){const e=moneyArr[t];var it=document.createElement("option");it.setAttribute("value",e.MONEY),it.innerText=e.MONEY,nt.appendChild(it)}nt.value=_;tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(nt),F.appendChild(tt),M.appendChild(F);F=document.createElement("td");F.setAttribute("style","width:5%");var ot=document.createElement("input");ot.setAttribute("name","price_other_"+row_count),ot.setAttribute("id","price_other_"+row_count),ot.setAttribute("type","text"),ot.setAttribute("onchange","hesapla('price_other',"+row_count+")"),ot.setAttribute("class","prtMoneyBox"),ot.setAttribute("style","width:30px"),ot.setAttribute("value",commaSplit(m,FiyatYuvarlama));tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(ot),F.appendChild(tt),M.appendChild(F);F=document.createElement("td");F.setAttribute("style","width:5%");X=document.createElement("input");X.setAttribute("name","price_"+row_count),X.setAttribute("id","price_"+row_count),X.setAttribute("type","text"),X.setAttribute("onchange","hesapla('price',"+row_count+")"),X.setAttribute("onClick","sellinputAllVal(this)"),X.setAttribute("class","prtMoneyBox"),X.setAttribute("style","width:30px"),X.setAttribute("value",commaSplit(U,FiyatYuvarlama));tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(X),F.appendChild(tt),M.appendChild(F);F=document.createElement("td");F.setAttribute("style","width:5%");var dt=document.createElement("input");dt.setAttribute("name","indirim1_"+row_count),dt.setAttribute("id","indirim1_"+row_count),dt.setAttribute("value",commaSplit(l)),dt.setAttribute("type","text"),dt.setAttribute("onchange","getSetNum(this)&hesapla('price',"+row_count+")"),dt.setAttribute("class","prtMoneyBox");tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(dt),F.appendChild(tt),M.appendChild(F);F=document.createElement("td");F.setAttribute("style","width:10%");var ut=document.createElement("input");ut.setAttribute("name","row_nettotal_"+row_count),ut.setAttribute("id","row_nettotal_"+row_count),ut.setAttribute("type","text"),ut.setAttribute("class","prtMoneyBox"),ut.setAttribute("value",commaSplit(0,Yuvarlama));tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(ut),F.appendChild(tt),M.appendChild(F);F=document.createElement("td");F.setAttribute("style","width:15%");j=document.createElement("input");j.setAttribute("name","product_name_other_"+row_count),j.setAttribute("id","product_name_other_"+row_count),j.setAttribute("type","text"),j.setAttribute("style","width:40px"),j.setAttribute("value",b);tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(j),F.appendChild(tt),M.appendChild(F);F=document.createElement("td");F.setAttribute("style","width:8%");j=document.createElement("input");j.setAttribute("name","detail_info_extra_"+row_count),j.setAttribute("id","detail_info_extra_"+row_count),j.setAttribute("type","text"),j.setAttribute("style","width:40px"),j.setAttribute("value",C);tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(j),F.appendChild(tt),M.appendChild(F);var lt=new Date;F=document.createElement("td");F.setAttribute("style","width:10%");j=document.createElement("input");j.setAttribute("name","deliver_date_"+row_count),j.setAttribute("id","deliver_date_"+row_count),j.setAttribute("type","date"),y.length>0?j.setAttribute("value",y):j.setAttribute("value",lt.toISOString().split("T")[0]);tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(j),F.appendChild(tt),M.appendChild(F);F=document.createElement("td");F.setAttribute("style","display:none"),F.setAttribute("class","hiddenR");var ct=document.createElement("input");ct.setAttribute("name","Tax_"+row_count),ct.setAttribute("id","Tax_"+row_count),ct.setAttribute("value",commaSplit(u));var st=document.createElement("input");st.setAttribute("name","converted_sid_"+row_count),st.setAttribute("id","converted_sid_"+row_count),st.setAttribute("value",S);tt=document.createElement("div");tt.setAttribute("class","form-group"),tt.appendChild(st),tt.appendChild(ct),F.appendChild(tt),M.appendChild(F);F=document.createElement("td"),tt=document.createElement("div");tt.setAttribute("class","form-group");var _t=document.createElement("input");_t.setAttribute("name","description_"+row_count),_t.setAttribute("id","description_"+row_count),_t.setAttribute("value",w),tt.appendChild(_t),F.appendChild(tt),M.appendChild(F),rowaListener(M);var mt=document.getElementById("tbl_basket");mt.appendChild(M),hesapla("other_money",rowCount),manuelControl(),RowControlForVirtual(),FiyatTalepKontrol(rowCount)}function InputCreator(t,e,a,r=[],n,i){var o=document.createElement("input");if(o.setAttribute("name",t),o.setAttribute("id",e),o.setAttribute("type",a),o.setAttribute("style",i),o.setAttribute("value",n),r.length>0)for(let t=0;t<r.length;t++)item=r[t],i_6.setAttribute(ite.event_type,item.event_);return o}function AsamaYapici(t,e){var a=document.createElement("select");a.setAttribute("name","orderrow_currency_"+t),a.setAttribute("id","orderrow_currency_"+t);var r=document.createElement("option");r.setAttribute("value",-5),r.innerText="Üretim",a.appendChild(r);r=document.createElement("option");r.setAttribute("value",-6),r.innerText="Sevk",a.appendChild(r);r=document.createElement("option");r.setAttribute("value",-2),r.innerText="Tedarik",a.appendChild(r);r=document.createElement("option");r.setAttribute("value",-1),r.innerText="Açık",a.appendChild(r);r=document.createElement("option");r.setAttribute("value",-10),r.innerText="Kapatıldı",a.appendChild(r);r=document.createElement("option");return r.setAttribute("value",1),r.innerText="Fiyat Talep",a.appendChild(r),a.value=e,a}function manuelControl(){var t=document.getElementsByClassName("sepetRow");for(let a=1;a<=t.length;a++){var e=document.getElementById("is_manuel_"+a).value;1==parseInt(e)&&$("#row_"+a).css("background","#86b5ff75"),hesapla("other_money",a)}}function UpdRow(t,e,a,r,n,i,o,d,u,l=-1,c="",s="Adet"){console.log("Basket PC Upd Row"),console.log(arguments),$("#product_id_"+u).val(t),$("#stock_id_"+u).val(e),$("#is_virtual_"+u).val(a),r>0&&$("#amount_"+u).val(r),n>0&&$("#price_"+u).val(n),$("#product_name_"+u).val(i),$("#Tax_"+u).val(o),d>0&&$("#indirim1_"+u).val(d),$("#orderrow_currency_"+u).val(l),$("#stock_code_"+u).val(c),$("#main_unit_"+u).val(s),hesapla("price",u),RowControlForVirtual()}function ShelfControl(t,e){var a="select DISTINCT SHELF_CODE,PPR.PRODUCT_PLACE_ID,PPR.PRODUCT_ID,PP.STORE_ID,PP.LOCATION_ID,PPR.PRODUCT_ID,SL.DEPARTMENT_LOCATION from "+generalParamsSatis.dataSources.dsn3+".PRODUCT_PLACE_ROWS AS PPR";a+=" LEFT JOIN "+generalParamsSatis.dataSources.dsn3+".PRODUCT_PLACE AS PP ON PP.PRODUCT_PLACE_ID=PPR.PRODUCT_PLACE_ID ",a+=" LEFT JOIN "+generalParamsSatis.dataSources.dsn+".STOCKS_LOCATION AS SL ON  SL.LOCATION_ID=PP.LOCATION_ID AND SL.DEPARTMENT_ID=PP.STORE_ID ",a+="WHERE PPR.PRODUCT_ID="+t+" AND SHELF_CODE='"+e+"'";var r=wrk_query(a,"dsn3");return 0!=r.recordcount||(0==generalParamsSatis.workingParams.IS_RAFSIZ?(alert("Ürün Bu Rafta Tanımlı Değildir Veya Raf Kodu Bulunamamıştır"),!1):(alert("Ürün Bu Rafta Tanımlı Değildir Veya Raf Kodu Bulunamamıştır Rafsız Kayıt Yapılacaktır"),!0))}function getRafSml(t,e){var a="SELECT PP.SHELF_CODE,SL.COMMENT,D.DEPARTMENT_HEAD,PP.LOCATION_ID,PP.STORE_ID FROM "+generalParamsSatis.dataSources.dsn3+".PRODUCT_PLACE_ROWS AS PPR ";a+=" LEFT JOIN "+generalParamsSatis.dataSources.dsn3+".PRODUCT_PLACE AS PP ON PPR.PRODUCT_PLACE_ID=PP.PRODUCT_PLACE_ID",a+=" LEFT JOIN "+generalParamsSatis.dataSources.dsn+".STOCKS_LOCATION AS SL ON SL.LOCATION_ID=PP.LOCATION_ID AND SL.DEPARTMENT_ID=PP.STORE_ID",a+=" LEFT JOIN "+generalParamsSatis.dataSources.dsn3+".DEPARTMENT AS D ON D.DEPARTMENT_ID=SL.DEPARTMENT_ID",a+=" WHERE PPR.STOCK_ID="+t+" AND PP.SHELF_CODE='"+e+"'";var r=wrk_query(a);return r.recordcount>0?r.DEPARTMENT_HEAD[0]+" "+r.COMMENT[0]:""}function hesapla(t,e){var a=$("#price_"+e).val(),r=$("#price_other_"+e).val();a=-1!=a.indexOf(",")?filterNum(a,8):filterNum(commaSplit(a),8),r=-1!=r.indexOf(",")?filterNum(r,8):filterNum(commaSplit(r),8);var n=filterNum($("#amount_"+e).val(),8),i=$("#cost_"+e).val(),o=filterNum($("#indirim1_"+e).val(),8),d=$("#other_money_"+e).val(),u=filterNum($("#_txt_rate1_"+$("input[id^='_hidden_rd_money_'][value='"+d+"']").prop("id").split("_")[4]).val(),8),l=filterNum($("#_txt_rate2_"+$("input[id^='_hidden_rd_money_'][value='"+d+"']").prop("id").split("_")[4]).val(),8);$("#qs_basket tbody tr[data-rc='"+e+"']").css("background-color","white"),list_find("price,other_money",t)?r=a*u/l:"price_other"==t&&(a=r*l/u);var c=a*(100-o)/100*n;if(generalParamsSatis.workingParams.MALIYET_CONTROL)if(parseFloat(a*(100-o)/100)<parseFloat(i))document.getElementById("row_"+e).setAttribute("style","background-color:#ff06005c");else{var s=parseInt(document.getElementById("is_manuel_"+e).value);0==s&&document.getElementById("row_"+e).removeAttribute("style")}$("#price_other_"+e).val(commaSplit(r,FiyatYuvarlama)),$("#price_"+e).val(commaSplit(a,FiyatYuvarlama)),$("#row_nettotal_"+e).val(commaSplit(c,Yuvarlama)),$("#amount_"+e).val(commaSplit(n,2)),toplamHesapla(),toplamHesapla_2()}function toplamHesapla(){var t=0,e=0,a=0;for(let r=1;r<=rowCount;r++)if($("#price_"+r).val()){
let n=filterNum($("#price_"+r).val(),8),i=(filterNum($("#price_other_"+r).val(),8),filterNum($("#amount_"+r).val(),8),filterNum($("#indirim1_"+r).val(),8),$("#Tax_"+r).val()),o=$("#other_money_"+r).val(),d=filterNum($("#row_nettotal_"+r).val(),8);filterNum($("#_txt_rate1_"+$("input[id^='_hidden_rd_money_'][value='"+o+"']").prop("id").split("_")[4]).val(),8),filterNum($("#_txt_rate2_"+$("input[id^='_hidden_rd_money_'][value='"+o+"']").prop("id").split("_")[4]).val(),8);parseFloat(n),t+=parseFloat(d),e+=parseFloat(d)*(parseInt(i)/100),a+=parseFloat(d)*(1+parseInt(i)/100)}$("#subTotal").val(commaSplit(t,ToplamYuvarlama)),$("#subTaxTotal").val(commaSplit(e,ToplamYuvarlama)),$("#subWTax").val(commaSplit(a,ToplamYuvarlama))}function toplamHesapla_2(){var t=document.getElementsByClassName("sepetRow"),e=0,a=0,r=0,n=0;for(let m=1;m<=t.length;m++){var i=filterNum(document.getElementById("price_"+m).value,ToplamYuvarlama);console.log(i);var o=filterNum(document.getElementById("amount_"+m).value),d=filterNum(document.getElementById("indirim1_"+m).value),u=filterNum(document.getElementById("Tax_"+m).value),l=i*o,c=l*d/100,s=l-c,_=s*u/100;e+=s,a+=_,r+=c,n+=l}var m=parseFloat(filterNum($("#txt_disc").val()));$("#txt_disc").val(commaSplit(m,3));var p=e*generalParamsSatis.workingParams.MAX_DISCOINT/100;m>p&&(alert("Genel İndirim İşlem Tutarının %"+generalParamsSatis.workingParams.MAX_DISCOINT+"'ndan büyük Olmaz İndirim 0'lanacaktır"),$("#txt_disc").val(commaSplit(0,3)),m=0),$("#txt_total").val(commaSplit(n,ToplamYuvarlama)),r+=m,$("#txt_disc_total").val(commaSplit(r,ToplamYuvarlama)),e=n-r,$("#txt_nokdv_total").val(commaSplit(e,ToplamYuvarlama)),$("#txt_kdv_total").val(commaSplit(a,ToplamYuvarlama)),$("#txt_withkdv_total").val(commaSplit(e+a,ToplamYuvarlama)),$("#basket_bottom_total").val(commaSplit(e+a,ToplamYuvarlama))}function sellinputAllVal(t){t.select()}function GetBasketData(){var t=document.getElementsByClassName("sepetRow"),e=new Array,a=0;for(let D=1;D<=t.length;D++){var r=document.getElementById("product_name_"+D).value,n=document.getElementById("product_id_"+D).value,i=document.getElementById("stock_id_"+D).value,o=document.getElementById("is_virtual_"+D).value,d=document.getElementById("amount_"+D).value,u=document.getElementById("price_"+D).value,l=document.getElementById("other_money_"+D).value,c=document.getElementById("is_karma_"+D).value,s=document.getElementById("row_nettotal_"+D).value,_=document.getElementById("converted_sid_"+D).value,m=document.getElementById("shelf_code_"+D).value,p=document.getElementById("Tax_"+D).value,A=document.getElementById("indirim1_"+D).value,v=document.getElementById("price_other_"+D).value,E=document.getElementById("orderrow_currency_"+D).value,b=document.getElementById("product_name_other_"+D).value,C=document.getElementById("detail_info_extra_"+D).value,I=document.getElementById("deliver_date_"+D).value,T=document.getElementById("is_production_"+D).value,y=document.getElementById("description_"+D).value,P=document.getElementById("row_uniq_id_"+D).value;if(!generalParamsSatis.workingParams.IS_ZERO_QUANTITY){var h=filterNum(u);h<=0&&a++,a>0&&alert("0 Fiyatlı Kayıt Yapamazsıznız")}var w={product_name:r,product_id:n,stock_id:i,is_virtual:o,amount:d,price:u,other_money:l,row_nettotal:s,shelf_code:m,Tax:p,indirim1:A,price_other:v,orderrow_currency:E,product_name_other:b,detail_info_extra:C,deliver_date_bask:I,is_production:T,row_uniq_id:P,description:y,converted_sid:_,is_karma:c};e.push(w)}var D=document.getElementById("company_id").value,S=document.getElementById("is_from_project").value,O=document.getElementById("company_name").value,g=document.getElementById("PAYMETHOD").value,f=document.getElementById("PAYMETHOD_ID").value,R=document.getElementById("VADE").value,N=document.getElementById("company_partner_name").value,B=document.getElementById("company_partner_id").value,x=document.getElementById("process_stage").value,k=document.getElementById("SHIP_METHOD").value,L=document.getElementById("SHIP_METHOD_ID").value,U=document.getElementById("order_id").value,M=document.getElementById("subTotal").value,F=document.getElementById("subTaxTotal").value,Y=document.getElementById("subWTax").value,H=document.getElementById("txt_total").value,K=document.getElementById("txt_disc").value,q=document.getElementById("txt_disc_total").value,G=document.getElementById("txt_nokdv_total").value,W=document.getElementById("txt_kdv_total").value,j=document.getElementById("txt_withkdv_total").value,J=document.getElementById("offer_date").value,V=document.getElementById("offer_head").value,X=document.getElementById("ship_address").value,z=document.getElementById("ship_address_id").value,Q=document.getElementById("city_id").value,Z=document.getElementById("county_id").value,tt=document.getElementById("offer_desc").value,et=document.getElementById("PRICE_CATID").value,at=document.getElementById("project_name").value,rt=document.getElementById("project_id").value;M=filterNum(M,ToplamYuvarlama),F=filterNum(F,ToplamYuvarlama),Y=filterNum(Y,ToplamYuvarlama),H=filterNum(H,ToplamYuvarlama),K=filterNum(K,ToplamYuvarlama),q=filterNum(q,ToplamYuvarlama),G=filterNum(G,ToplamYuvarlama),W=filterNum(W,ToplamYuvarlama),j=filterNum(j,ToplamYuvarlama);var nt=$(document),it=nt.find("input[name=_rd_money]:checked").val(),ot="";$("#snl_teklif").is(":checked")&&(ot+="1,"),$("#siparis").is(":checked")&&(ot+="2,"),$("#sevkiyat").is(":checked")&&(ot+="3,"),$("#sales_type_1").is(":checked")&&(ot+="4,");var dt=document.getElementById("_hidden_rd_money_"+it).value,ut=document.getElementById("_txt_rate1_"+it).value,lt=document.getElementById("_txt_rate2_"+it).value,ct=document.getElementById("plasiyer").value,st=document.getElementById("plasiyer_id").value,_t=filterNum(ut,4),mt=filterNum(lt,4),pt=getParameterByName("fuseaction"),At={COMPANY_ID:D,PAYMETHOD:g,PAYMETHOD_ID:f,VADE:R,COMPANY_PARTNER_NAME:N,COMPANY_PARTNER_ID:B,MEMBER_NAME:O,PROCESS_STAGE:x,SHIP_METHOD:k,SHIP_METHOD_ID:L,ORDER_ID:U,OFFER_DATE:J,OFFER_HEAD:V,SHIP_ADDRESS:X,SHIP_ADDRESS_ID:z,CITY_ID:Q,COUNTY_ID:Z,ISLEM_TIPI_PBS:ot,PRICE_CATID:et,PLASIYER:ct,PLASIYER_ID:st,FACT:pt,OFFER_DESCRIPTION:tt,PROJECT_NAME:at,PROJECT_ID:rt,IS_FROM_PROJECT:S,IS_FROM_PROJECT:S},vt={SUBTOTAL:M,SUBTAXTOTAL:F,SUBNETTOTAL:Y,BASKET_MONEY:dt,BASKET_RATE_1:_t,BASKET_RATE_2:mt,GROSS_TOTAL:H,AFTER_DISCOUNT:K,DISCOUNT_TOTAL:q,TOTAL_WITHOUT_KDV:G,TAX_TOTAL:W,TOTAL_WITH_KDV:j},Et={OrderHeader:At,OrderRows:e,OrderMoney:moneyArr,OrderFooter:vt,WORKING_PARAMS:generalParamsSatis.workingParams};return Et}function KntO(){var t=0,e=document.getElementsByClassName("sepetRow"),a=document.getElementById("siparis"),r=$(a).is(":checked");for(let a=1;a<=e.length;a++){var n=$("#orderrow_currency_"+a).val();-5!=parseInt(n)&&-2!=parseInt(n)||r||(alert("Sipariş Seçili Olması Gerekmektedir"),t=!0),-1==parseInt(n)&&r&&(alert("Sipariş Yapmak İçin Açıkta Aşama Kalmış Olmaması Gerekmektedir "),t=!0),1==parseInt(n)&&r&&(alert("Fiyat Talep Aşamasında  Kalmış Olmaması Gerekmektedir "),t=!0)}return!t}function SaveOrder(t){t.setAttribute("disabled","true");var e=GetBasketData();KntO()?e&&SendFormData("/index.cfm?fuseaction=sales.emptypopup_query_save_order",e):t.removeAttribute("disabled")}function GruplaCanimBenim(){var t=!1,e=prompt("Hortum Takımı Adı ?"),a=document.getElementById("PRICE_CATID").value,r=document.getElementById("company_id").value,n=new Array,i=0;for(let t=0;t<selectedArr.length;t++){var o=selectedArr[t].getAttribute("data-producttype"),d=selectedArr[t].getAttribute("data-rc"),u=document.getElementById("product_id_"+d).value,l=document.getElementById("stock_id_"+d).value,c=document.getElementById("amount_"+d).value;c=parseFloat(filterNum(c));document.getElementById("main_unit_"+d).value;var s=document.getElementById("price_other_"+d).value;s=parseFloat(filterNum(s,Yuvarlama));var _=document.getElementById("other_money_"+d).value,m=document.getElementById("price_"+d).value;m=parseFloat(filterNum(m,Yuvarlama));var p=document.getElementById("Tax_"+d).value;p=filterNum(p);var A=parseFloat(m)*parseFloat(c);i+=A,console.log(u);var v={PRODUCT_ID:u,STOCK_ID:l,AMOUNT:c,PRICE:s,OTHER_MONEY:_,ROW_NET_TOTAL:A,TAX:p};n.push(v),parseInt(o)}var E={PRODUCT_NAME_MAIN:e,PRODUCT_LIST:n,PRICE_CATID:a,COMPANY_ID:r,PRICE_TOTAL:i};if(1==t)return!1;SendFormData("/index.cfm?fuseaction=product.emptypopup_makeTubeGroup",E)}function SendFormData(t,e){var a=document.createElement("form");a.target="Map",a.method="POST",a.action=t;var r=document.createElement("input");r.type="hidden",r.name="data",r.value=JSON.stringify(e),a.appendChild(r),document.body.appendChild(a),map=window.open(t,"Map","status=0,title=0,height=600,width=800,scrollbars=1"),map?a.submit():alert("You must allow popups for this map to work.")}function selectrw(t){if(rwwwx=t,$(rwwwx).is(":checked")){var e=rwwwx.getAttribute("data-row"),a=document.getElementById("row_"+e);a.setAttribute("style","background-color:#aaefff80"),a.setAttribute("data-selected",1)}else{e=rwwwx.getAttribute("data-row"),a=document.getElementById("row_"+e);a.setAttribute("style","background-color:#fff"),a.setAttribute("data-selected",0)}BasketSelControl()}function groupControl(){GruplaCanimBenim()}function BasketSelControl(){selectedArr.splice(0,selectedArr.length);var t={icon:"icn-md fa fa-cubes",txt:"Grupla",evntType:"onclick",evnt:"groupControl()",att:"disabled"},e={icon:"icn-md icon-remove",txt:"Seçili Olanları Sil",evntType:"onclick",evnt:"removeSelected(this)",att:""},a={icon:"icn-md fa fa-history",txt:"Güncelle",evntType:"onclick",evnt:"return true",att:"disabled"},r={icon:"icn-md fa fa-tree",txt:"Ağaç Görüntüle",evntType:"onclick",evnt:"showTree(this)",att:"disabled"},n={icon:"icn-md fa fa-recycle",txt:"Fiyat Detay",evntType:"onclick",evnt:"TurnOut(this)",att:"disabled"},i={icon:"icn-md icon-check",txt:"Gerçek Ürüne Dönüştür",evntType:"onclick",evnt:"ConvertRealProduct(this)",att:"disabled"},o={icon:"icn-md icon-check",txt:"Aliş Fiyatı Ekle",evntType:"onclick",evnt:"AddPurchasePrice(this)",att:"disabled"},d=[],u=document.getElementsByClassName("sepetRow");for(let t=0;t<u.length;t++){var l=u[t],c=l.getAttribute("data-selected");1==parseInt(c)&&selectedArr.push(l)}if(1==selectedArr.length){var s=selectedArr[0],_=s.getAttribute("data-rc"),m=s.getAttribute("data-producttype"),p=s.getAttribute("data-priceOffer"),A=$(s).find("#is_virtual_"+_).val(),v=$(s).find("#product_id_"+_).val();o={icon:"icn-md icon-check",txt:"Aliş Fiyatı Ekle",evntType:"onclick",evnt:"AddPurchasePrice("+v+","+_+")",att:"disabled"};if(1==parseInt(A)){if(1==parseInt(m))a={icon:"icn-md fa fa-history",txt:"Güncelle",evntType:"onclick",evnt:"openHose("+v+","+_+")",att:""};else if(2==parseInt(m))a={icon:"icn-md fa fa-history",txt:"Güncelle",evntType:"onclick",evnt:"openHydrolic("+v+","+_+",1)",att:""};else if(4==parseInt(m))a={icon:"icn-md fa fa-history",txt:"Güncelle",evntType:"onclick",evnt:"openVirtualProduct("+v+","+_+")",att:""};else if(0==parseInt(m)||99==parseInt(m))i={icon:"icn-md icon-check",txt:"Gerçek Ürüne Dönüştür",evntType:"onclick",evnt:"ConvertRealProduct("+v+","+_+")",att:""}}else r={icon:"icn-md fa fa-tree",txt:"Ağaç Görüntüle",evntType:"onclick",evnt:"showTree("+_+")",att:""};if(1==parseInt(p))n={icon:"icn-md fa fa-recycle",txt:"Fiyat Talep Sonuçları",evntType:"onclick",evnt:"TurnOut(this,"+_+")",att:""}}return d.push(e,a,t,r,n,i,o),d}function showTree(t){elks=t,console.log(t);var e=document.getElementById("stock_id_"+t).value;openBoxDraggable("index.cfm?fuseaction=objects.emptypopup_show_tree_prt&stock_id="+e)}function TurnOut(t,e){var a=document.getElementById("row_uniq_id_"+e).value;openBoxDraggable("index.cfm?fuseaction=sales.emptypopup_add_pbs_offer_price_offerings&OfferrowUniqId="+a+"&row_id="+e)}function rowaListener(t){$(t).on("contextmenu",function(t){$(".pbsContex").remove(),t.preventDefault();var e=document.createElement("div");e.setAttribute("class","pbsContex"),$(e).attr("style","display:none;top:"+t.clientY+"px;left:"+t.clientX+"px");var a=document.createElement("div");a.setAttribute("style","border-top: solid 5px black;border-left: solid 5px black;width: 10px;height: 10px;");var r=document.createElement("div");r.setAttribute("class","list-group");var n=BasketSelControl();for(let t=0;t<n.length;t++){var i=n[t],o=document.createElement("a"),d=document.createElement("span");d.setAttribute("class",i.icon),d.setAttribute("style","margin-right:10px");var u=document.createElement("span");u.innerText=i.txt,o.appendChild(d),o.appendChild(u),"disabled"==i.att&&o.setAttribute("disabled",""),o.setAttribute("class","list-group-item"),o.setAttribute(i.evntType,i.evnt),r.appendChild(o)}e.appendChild(a),e.appendChild(r),document.body.appendChild(e),$(e).show(500)})}function removeSelected(t){RemSelected(),$(t.parentElement.parentElement).remove()}function RemSelected(){for(let t=0;t<selectedArr.length;t++)$(selectedArr[t]).remove();selectedArr.splice(0,selectedArr.length),rowArrange(),toplamHesapla_2(),toplamHesapla()}function rowArrange(){var t=document.getElementsByClassName("sepetRow");for(let R=0;R<t.length;R++){var e=R+1,a=t[R],r=a.getAttribute("data-rc");a.setAttribute("id","row_"+e),a.setAttribute("data-selected","0"),a.setAttribute("data-rc",e);var n=document.getElementById("product_name_"+r),i=$(a).find("input:checkbox")[0];i.setAttribute("data-row",e),n.setAttribute("id","product_name_"+e),n.setAttribute("name","product_name_"+e);var o=document.getElementById("spn_"+r);o.innerText=e,o.setAttribute("id","spn_"+e);var d=document.getElementById("product_id_"+r);d.setAttribute("id","product_id_"+e),d.setAttribute("name","product_id_"+e);var u=document.getElementById("is_manuel_"+r);u.setAttribute("id","is_manuel_"+e),u.setAttribute("name","is_manuel_"+e);var l=document.getElementById("is_karma_"+r);l.setAttribute("id","is_karma_"+e),l.setAttribute("name","is_karma_"+e);var c=document.getElementById("stock_id_"+r);c.setAttribute("id","stock_id_"+e),c.setAttribute("name","stock_id_"+e);var s=document.getElementById("is_production_"+r);s.setAttribute("id","is_production_"+e),s.setAttribute("name","is_production_"+e);var _=document.getElementById("is_virtual_"+r);_.setAttribute("id","is_virtual_"+e),_.setAttribute("name","is_virtual_"+e);var m=document.getElementById("row_uniq_id_"+r);m.setAttribute("id","row_uniq_id_"+e),m.setAttribute("name","row_uniq_id_"+e);var p=document.getElementById("cost_"+r);p.setAttribute("id","cost_"+e),p.setAttribute("name","cost_"+e);var A=document.getElementById("amount_"+r);A.setAttribute("id","amount_"+e),A.setAttribute("name","amount_"+e);var v=document.getElementById("price_"+r);v.setAttribute("id","price_"+e),v.setAttribute("name","price_"+e);var E=document.getElementById("stock_code_"+r);E.setAttribute("id","stock_code_"+e),E.setAttribute("name","stock_code_"+e);var b=document.getElementById("brand_name_"+r);b.setAttribute("id","brand_name_"+e),b.setAttribute("name","brand_name_"+e);var C=document.getElementById("main_unit_"+r);C.setAttribute("id","main_unit_"+e),C.setAttribute("name","main_unit_"+e);var I=document.getElementById("product_name_other_"+r);I.setAttribute("id","product_name_other_"+e),I.setAttribute("name","product_name_other_"+e);var T=document.getElementById("detail_info_extra_"+r);T.setAttribute("id","detail_info_extra_"+e),T.setAttribute("name","detail_info_extra_"+e);var y=document.getElementById("deliver_date_"+r);y.setAttribute("id","deliver_date_"+e),y.setAttribute("name","deliver_date_"+e);var P=document.getElementById("price_other_"+r);P.setAttribute("id","price_other_"+e),P.setAttribute("name","price_other_"+e);P=document.getElementById("other_money_"+r);P.setAttribute("id","other_money_"+e),P.setAttribute("name","other_money_"+e);var h=document.getElementById("row_nettotal_"+r);h.setAttribute("id","row_nettotal_"+e),h.setAttribute("name","row_nettotal_"+e);var w=document.getElementById("converted_sid_"+r);w.setAttribute("id","converted_sid_"+e),w.setAttribute("name","converted_sid_"+e);var D=document.getElementById("shelf_code_"+r);D.setAttribute("id","shelf_code_"+e),D.setAttribute("name","shelf_code_"+e);var S=document.getElementById("orderrow_currency_"+r);S.setAttribute("id","orderrow_currency_"+e),S.setAttribute("name","orderrow_currency_"+e);var O=document.getElementById("Tax_"+r);O.setAttribute("id","Tax_"+e),O.setAttribute("name","Tax_"+e);var g=document.getElementById("indirim1_"+r);g.setAttribute("id","indirim1_"+e),g.setAttribute("name","indirim1_"+e);var f=document.getElementById("description_"+r);f.setAttribute("id","description_"+e),f.setAttribute("name","description_"+e)}row_count=t.length,rowCount=t.length}function RowControlForVirtual(){var t=document.getElementsByClassName("sepetRow"),e=!1;for(let r=1;r<=t.length;r++){var a=document.getElementById("is_virtual_"+r);1==parseInt(a.value)&&(e=!0)}e?(document.getElementById("siparis").setAttribute("disabled","true"),document.getElementById("sevkiyat").setAttribute("disabled","true"),$(document.getElementById("snl_teklif")).click()):(document.getElementById("siparis").removeAttribute("disabled"),document.getElementById("sevkiyat").removeAttribute("disabled"))}function getProductMultiUse(t,e,a){function r(r){if(n=!1,window.XMLHttpRequest)try{n=new XMLHttpRequest}catch(t){n=!1}else if(window.ActiveXObject)try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){n=!1}}if(n){function o(){4==n.readyState&&200==n.status&&(JSON.parse(n.responseText.replace(/\u200B/g,"")),i=JSON.parse(n.responseText.replace(/\u200B/g,"")))}n.open("post",r+"&xmlhttp=1",!1),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.setRequestHeader("pragma","nocache"),n.send("keyword="+t+"&userid="+generalParamsSatis.userData.user_id+"&dsn2="+generalParamsSatis.dataSources.dsn2+"&dsn1="+generalParamsSatis.dataSources.dsn1+"&dsn3="+generalParamsSatis.dataSources.dsn3+"&price_catid="+a+"&comp_id="+e),o()}}var n,i=new Object;return r("/AddOns/Partner/satis/cfc/hizli_satis.cfc?method=getProduct"),i}function getProductMultiUseA(t,e,a,r=0){function n(n){if(i=!1,window.XMLHttpRequest)try{i=new XMLHttpRequest}catch(t){i=!1}else if(window.ActiveXObject)try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){i=!1}}if(i){function d(){4==i.readyState&&200==i.status&&(JSON.parse(i.responseText.replace(/\u200B/g,"")),o=JSON.parse(i.responseText.replace(/\u200B/g,"")))}i.open("post",n+"&xmlhttp=1",!1),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("pragma","nocache"),i.send("keyword="+t+"&question_id="+r+"&userid="+generalParamsSatis.userData.user_id+"&dsn2="+generalParamsSatis.dataSources.dsn2+"&dsn1="+generalParamsSatis.dataSources.dsn1+"&dsn3="+generalParamsSatis.dataSources.dsn3+"&price_catid="+a+"&comp_id="+e+"&dsn="+generalParamsSatis.dataSources.dsn),d()}}var i,o=new Object;return n("/AddOns/Partner/satis/cfc/hizli_satis.cfc?method=getProductListpbs"),o}function openPriceListPartner(t,e,a,r){var n="";moneyArr.forEach(function(t,e){console.log(t.MONEY),n+=t.MONEY+"="+t.RATE2+"&"});var i="index.cfm?fuseaction=objects.emptypopup_price_history_partner&"+n+"sepet_process_type=-1&product_id="+t+"&stock_id="+e+"&pid="+t+"&product_name=&unit="+a+"&row_id=0&company_id="+r;openBoxDraggable(i)}function searchCode(t,e){var a=t.value;$(".stockkodu").filter(function(){$(this).parent().parent().parent().toggle($(this).val().toLowerCase().indexOf(a.toLowerCase())>-1)})}function searchName(t,e){var a=t.value;$(".urunadi").filter(function(){$(this).parent().parent().parent().toggle($(this).val().toLowerCase().indexOf(a.toLowerCase())>-1)})}function moveRow(t,e){if(1!=t){var a=$("#row_"+t).attr("data-producttype"),r=$("#row_"+e).attr("data-producttype"),n=$("#product_id_"+t).val(),i=$("#stock_id_"+t).val(),o=$("#is_virtual_"+t).val(),d=$("#shelf_code_"+t).val(),u=$("#cost_"+t).val(),l=$("#is_production_"+t).val(),c=$("#row_uniq_id_"+t).val(),s=$("#stock_code_"+t).val(),_=$("#product_name_"+t).val(),m=$("#brand_name_"+t).val(),p=$("#department_name"+t).val(),A=$("#amount_"+t).val(),v=$("#main_unit_"+t).val(),E=$("#other_money_"+t).val(),b=$("#price_other_"+t).val(),C=$("#price_"+t).val(),I=$("#indirim1_"+t).val(),T=$("#row_nettotal_"+t).val(),y=$("#detail_info_extra_"+t).val(),P=$("#deliver_date_"+t).val(),h=$("#Tax_"+t).val(),w=$("#orderrow_currency_"+t).val(),D=$("#description_"+t).val(),S=$("#product_name_other_"+t).val(),O=$("#is_karma_"+t).val(),g=$("#product_id_"+e).val(),f=$("#stock_id_"+e).val(),R=$("#is_virtual_"+e).val(),N=$("#shelf_code_"+e).val(),B=$("#cost_"+e).val(),x=$("#is_production_"+e).val(),k=$("#row_uniq_id_"+e).val(),L=$("#stock_code_"+e).val(),U=$("#product_name_"+e).val(),M=$("#brand_name_"+e).val(),F=$("#department_name"+e).val(),Y=$("#amount_"+e).val(),H=$("#main_unit_"+e).val(),K=$("#other_money_"+e).val(),q=$("#price_other_"+e).val(),G=$("#price_"+e).val(),W=$("#indirim1_"+e).val(),j=$("#row_nettotal_"+e).val(),J=$("#detail_info_extra_"+e).val(),V=$("#deliver_date_"+e).val(),X=$("#Tax_"+e).val(),z=$("#orderrow_currency_"+e).val(),Q=$("#description_"+e).val(),Z=$("#product_name_other_"+e).val(),tt=$("#is_karma_"+e).val();$("#product_id_"+e).val(n),$("#product_id_"+t).val(g),$("#stock_id_"+e).val(i),$("#stock_id_"+t).val(f),$("#is_virtual_"+e).val(o),$("#is_virtual_"+t).val(R),$("#shelf_code_"+e).val(d),$("#shelf_code_"+t).val(N),$("#cost_"+e).val(u),$("#cost_"+t).val(B),$("#is_production_"+e).val(l),$("#is_production_"+t).val(x),$("#is_karma_"+e).val(O),$("#is_karma_"+t).val(tt),$("#row_uniq_id_"+e).val(c),$("#row_uniq_id_"+t).val(k),$("#stock_code_"+e).val(s),$("#stock_code_"+t).val(L),$("#product_name_"+e).val(_),$("#product_name_"+t).val(U),$("#brand_name_"+e).val(m),$("#brand_name_"+t).val(M),$("#department_name"+e).val(p),$("#department_name"+t).val(F),$("#amount_"+e).val(A),$("#amount_"+t).val(Y),$("#main_unit_"+e).val(v),$("#main_unit_"+t).val(H),$("#other_money_"+e).val(E),$("#other_money_"+t).val(K),$("#price_other_"+e).val(b),$("#price_other_"+t).val(q),$("#price_"+e).val(C),$("#price_"+t).val(G),$("#indirim1_"+e).val(I),$("#indirim1_"+t).val(W),$("#row_nettotal_"+e).val(T),$("#row_nettotal_"+t).val(j),$("#detail_info_extra_"+e).val(y),$("#detail_info_extra_"+t).val(J),$("#Tax_"+e).val(h),$("#Tax_"+t).val(X),$("#deliver_date_"+e).val(P),$("#deliver_date_"+t).val(V),$("#orderrow_currency_"+e).val(w),$("#orderrow_currency_"+t).val(z),$("#description_"+e).val(D),$("#description_"+t).val(Q),$("#product_name_other_"+e).val(S),$("#product_name_other_"+t).val(Z),document.getElementById("row_"+e).setAttribute("data-producttype",a),document.getElementById("row_"+t).setAttribute("data-producttype",r),hesapla("price",t),hesapla("price",e)}}function GenerateUniqueId(){var t=new Date,e=t.toISOString().split("T")[0],a=t.toISOString().split("T")[1],r=e.replaceAll("-",""),n=a.replaceAll(":","");n=n.replaceAll(".",""),console.log(n);var i="PBS"+generalParamsSatis.userData.user_id+r+n;return i}function getSetNum(t){var e=t.value;0==e.length?t.value=commaSplit(0):t.value=commaSplit(e)}function CheckSatilabilir(){var t=new Array;for(let d=1;d<=row_count;d++){var e=document.getElementById("stock_id_"+d).value,a=document.getElementById("amount_"+d).value,r=parseFloat(filterNum(a)),n=document.getElementById("row_"+d),i=t.findIndex(t=>t.STOCK_ID==e);if(-1==i){var o=new Object;o.STOCK_ID=e,o.MIKTAR=r,t.push(o)}else t[i].MIKTAR+=r}for(let a=0;a<t.length;a++){var d=wrk_query("SELECT ISNULL("+generalParamsSatis.dataSources.dsn2+".GET_S_DEPO_STOK("+t[a].STOCK_ID+"),0) as SATILABILIR","dsn2"),u=parseFloat(d.SATILABILIR[0]);console.log(u);var l=!1;u<t[a].MIKTAR&&(l=!0);for(let r=1;r<=row_count;r++){e=document.getElementById("stock_id_"+r).value,n=document.getElementById("row_"+r);e==t[a].STOCK_ID&&(l?n.setAttribute("style","background:#ff5959"):n.removeAttribute("style"),console.log("miktar yokrow_"+r+"DD="+l))}}}function openPump(t){windowopen("index.cfm?fuseaction=product.emptypopup_virtual_main_partner&type=3&id="+t+"&company_id="+CompanyData.COMPANY_ID+"&PRICE_CATID="+CompanyData.PRICE_CAT,"wwide")}function FiyatTalepKontrol(t=0){if(0!=t){var e=$("#row_uniq_id_"+t).val(),a=$("#orderrow_currency_"+t).val();if(1==parseInt(a)){console.log(e);var r="SELECT * FROM PBS_OFFER_ROW_PRICE_OFFER WHERE UNIQUE_RELATION_ID='"+e+"'",n=wrk_query(r,"dsn3");if(1==parseInt(n.IS_ACCCEPTED[0])){var i=document.getElementById("row_"+t);i.setAttribute("style","background:#ffd70069"),i.setAttribute("data-priceOffer","1")}}}else for(let t=1;t<=row_count;t++){e=$("#row_uniq_id_"+t).val(),a=$("#orderrow_currency_"+t).val();if(1==parseInt(a)){console.log(e);r="SELECT * FROM PBS_OFFER_ROW_PRICE_OFFER WHERE UNIQUE_RELATION_ID='"+e+"'",n=wrk_query(r,"dsn3");if(1==parseInt(n.IS_ACCCEPTED[0])){i=document.getElementById("row_"+t);i.setAttribute("style","background:#ffd70069"),i.setAttribute("data-priceOffer","1")}console.log(n)}}}function setFiyatA(t,e,a,r){$("#price_"+t).val(e),$("#other_money_"+t).val(a),$("orderrow_currency_"+t).val(-6),hesapla("price",t),closeBoxDraggable(r)}function AddPurchasePrice(t,e){var a=document.getElementById("row_uniq_id_"+e).value;openBoxDraggable("index.cfm?fuseaction=project.emptypopup_mini_tools&tool_type=AddPurchasePrice&uniq_id="+a,"1453162606")}function ConvertRealProduct(pid,rwid){if("0"==document.getElementById("is_virtual_"+rwid).value){openBoxDraggable("index.cfm?fuseaction=project.emptypopup_mini_tools&Message=Gerçek Ürüne Dönüşmüştür&tool_type=showMessage&AlertType=danger","1453162606");var e=setTimeout(function(){closeBoxDraggable("1453162606")},5e3)}$.ajax({url:"index.cfm?fuseaction=objects.emptypopup_createRealProductPbs&ajax=1&ajax_box_page=1&isAjax=1&VIRTUAL_PRODUCT_ID="+pid+"&ROW_ID="+rwid,beforeSend:function(){openBoxDraggable("index.cfm?fuseaction=project.emptypopup_mini_tools&tool_type=showMessage&AlertType=warning","1453162606")},success:function(retDat){closeBoxDraggable("1453162606"),console.log(retDat);var O=JSON.parse(retDat.trim());console.log(O);var PidE=eval("O[0].PRODUCT_ID_"+pid),SidE=eval("O[0].STOCK_ID_"+pid),PCODE=eval("O[0].PRODUCT_CODE_"+pid);document.getElementById("product_id_"+rwid).value=PidE,document.getElementById("stock_id_"+rwid).value=SidE,document.getElementById("is_virtual_"+rwid).value=0,document.getElementById("stock_code_"+rwid).value=PCODE}})}function getKarmaProducts(t,e){var a=17,r="";r+="select S.PRODUCT_NAME,S.PRODUCT_ID,S.PRODUCT_CODE,S.STOCK_ID,S.TAX,S.TAX_PURCHASE,KP.PRODUCT_AMOUNT,PB.BRAND_NAME,PC.DETAIL,PU.MAIN_UNIT,KP.KARMA_PRODUCT_ID,CASE WHEN (",r+="  SELECT TOP 1 PROPERTY1 FROM "+generalParamsSatis.dataSources.dsn3+".PRODUCT_INFO_PLUS WHERE",r+=" PRODUCT_INFO_PLUS.PRODUCT_ID = S.PRODUCT_ID ORDER BY PROPERTY1 DESC) ='MANUEL' THEN 1 ELSE 0 END AS IS_MANUEL,",r+="( SELECT TOP 1 PCE.DISCOUNT_RATE FROM "+generalParamsSatis.dataSources.dsn1+".PRODUCT P, "+generalParamsSatis.dataSources.dsn3+".PRICE_CAT_EXCEPTIONS PCE LEFT JOIN "+generalParamsSatis.dataSources.dsn3+".PRICE_CAT PC ON PC.PRICE_CATID = PCE.PRICE_CATID",r+=" WHERE (PCE.PRODUCT_ID = P.PRODUCT_ID OR PCE.PRODUCT_ID IS NULL ) AND ( PCE.BRAND_ID = P.BRAND_ID OR PCE.BRAND_ID IS NULL) AND ( PCE.PRODUCT_CATID = P.PRODUCT_CATID OR PCE.PRODUCT_CATID IS NULL)",r+=" AND P.PRODUCT_ID = S.PRODUCT_ID AND ISNULL(PC.IS_SALES,0) = 1 AND PCE.ACT_TYPE NOT IN (2,4) AND  PC.PRICE_CATID = "+a+" ORDER BY PCE.PRODUCT_ID DESC, PCE.PRODUCT_CATID DESC,PCE.BRAND_ID DESC) AS DISCOUNT",r+=",( SELECT TOP 1 IR.PRICE-(IR.DISCOUNTTOTAL/2) AS PRICE FROM "+generalParamsSatis.dataSources.dsn2+". INVOICE I LEFT JOIN "+generalParamsSatis.dataSources.dsn2+".INVOICE_ROW IR ON IR.INVOICE_ID = I.INVOICE_ID WHERE ISNULL(I.PURCHASE_SALES,0) = 0 AND",r+=" IR.PRODUCT_ID = S.PRODUCT_ID AND I.PROCESS_CAT<>35 ORDER BY I.INVOICE_DATE DESC) AS LAST_COST ,ISNULL(GPA.PRICE,KP.SALES_PRICE) AS PRICE ,ISNULL(GPA.MONEY,KP.MONEY) AS MONEY",r+=" from "+generalParamsSatis.dataSources.dsn1+".KARMA_PRODUCTS AS KP LEFT JOIN "+generalParamsSatis.dataSources.dsn3+".STOCKS AS S ON S.PRODUCT_ID=KP.PRODUCT_ID LEFT JOIN "+generalParamsSatis.dataSources.dsn1+".PRODUCT_UNIT AS PU ON PU.PRODUCT_ID=S.PRODUCT_ID AND PU.IS_MAIN=1 LEFT JOIN",r+=" (SELECT P.UNIT,P.PRICE,P.PRICE_KDV,P.PRODUCT_ID,P.MONEY,P.PRICE_CATID,P.CATALOG_ID,P.PRICE_DISCOUNT FROM "+generalParamsSatis.dataSources.dsn3+".PRICE P, "+generalParamsSatis.dataSources.dsn3+".PRODUCT PR WHERE P.PRODUCT_ID = PR.PRODUCT_ID AND P.PRICE_CATID = "+a,r+=" AND ( P.STARTDATE <= GETDATE() AND ( P.FINISHDATE >=GETDATE() OR P.FINISHDATE IS NULL)) AND ISNULL(P.SPECT_VAR_ID, 0) = 0 ) AS GPA ON GPA.PRODUCT_ID = S.PRODUCT_ID AND GPA.UNIT = PU.PRODUCT_UNIT_ID ",r+=" LEFT JOIN workcube_metosan_1.PRODUCT_BRANDS AS PB ON PB.BRAND_ID=S.BRAND_ID LEFT JOIN workcube_metosan_1.PRODUCT_CAT AS PC ON PC.PRODUCT_CATID=S.PRODUCT_CATID",r+=" WHERE KP.KARMA_PRODUCT_ID="+t;var n=wrk_query(r,"dsn3");console.log(n);for(let t=0;t<n.recordcount;t++)AddRow(n.PRODUCT_ID[t],n.STOCK_ID[t],n.PRODUCT_CODE[t],n.BRAND_NAME[t],0,n.PRODUCT_AMOUNT[t],n.PRICE[t],n.PRODUCT_NAME[t],n.TAX[t],n.DISCOUNT[t],n.DETAIL[t],"",n.MONEY[t],n.PRICE[t],-6,n.IS_MANUEL[t],n.LAST_COST[t],n.MAIN_UNIT[t],"","",0,"","",0,"","","",0,0,0,1)}var HataArr=[],row_count=0,rwww="",rwwwx="",rwwwxy="",selectedCount=0,rowCount=0,tempProductData="",selectedArr=[],selectedMoney="",CompanyData=new Object,Yuvarlama=4,FiyatYuvarlama=4,ToplamYuvarlama=4;$(document).ready(function(){setDoom(),"upd"==getParameterByName("event")&&CalisanKontrolPbs()});var elks="";