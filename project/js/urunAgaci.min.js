function ngetTree(t,e,n,a,r=1,i="",l="",d=""){if(console.log(arguments),1==r){a.parentElement.children[0].innerText;$("#pnamemain").val(l),$("#vp_id").val(t),$("#is_virtual").val(e),$("#pstage").val(d),$.ajax({url:"/AddOns/Partner/project/cfc/product_design.cfc?method=getTree&product_id="+t+"&isVirtual="+e+"&ddsn3="+n,success:function(t){var e=strToJson(t);o=JSON.parse(e),AgaciYaz(o,0,"0",1);var n=document.getElementById("TreeArea");n.innerHTML="",n.appendChild(ulx),agacGosterEkle(),sortableYap(),virtuallariYerlestir()}})}else $.ajax({url:"/AddOns/Partner/project/cfc/product_design.cfc?method=getTree&product_id="+t+"&isVirtual="+e+"&ddsn3="+n,success:function(t){var e=strToJson(t);o=JSON.parse(e),console.log("Buradayım");var n=AgaciYaz_12(o,0,"",0);i.appendChild(n),agacGosterEkle(),sortableYap(),virtuallariYerlestir()}})}function patnerEkle(t){console.log(t)}function strToJson(t){var e="";for(let a=0;a<t.length;a++){var n=t.charAt(a).trim();","==n&&"]"==t.charAt(a+1).trim()&&(console.log("ebe"),n=""),e+=n}return e}function AgaciYaz(t,e,n="0",a="1"){console.log("AgaciYaz Virtual="+a);var r=ProductDesingSetting.find(t=>"update_real_product"==t.paramName).paramValue;ulx.innerHTML="";var i=document.createElement("ul");i.setAttribute("class","list-group"),i.setAttribute("data-is_virtual",a),i.setAttribute("data-seviye",e),i.setAttribute("id",idA),idA+=1;n=n;n+=e.toString();for(let a=0;a<t.length;a++){var o=document.createElement("li");e<=0&&(e=t[a].RNDM_ID);var l=document.createElement("span");l.setAttribute("name","product_name_");var d=VIRTUAL_PRODUCT_TREE_QUESTIONS.find(e=>e.QUESTION_ID==t[a].QUESTION_ID);t[a].PRODUCT_NAME;d=null!=d?"<span style='color:var(--danger)'>("+d.QUESTION+")</span>":"",l.innerHTML=t[a].PRODUCT_NAME+" "+d,o.setAttribute("data-product_id",t[a].PRODUCT_ID),o.setAttribute("data-IS_VIRTUAL",t[a].IS_VIRTUAL),i.setAttribute("data-IS_VIRTUAL",t[a].IS_VIRTUAL),o.setAttribute("data-PRODUCT_TREE_ID",t[a].PRODUCT_TREE_ID),o.setAttribute("data-question_id",t[a].QUESTION_ID),o.setAttribute("data-idb",idB),idB++;var s=document.createElement("div"),u=buttonCreator("","btn btn-outline-success","onclick","getitem(this)","+"),c=buttonCreator("","btn btn-outline-danger","onclick","remItem(this)","-"),p=inputCreator("text","amount","onchange","console.log(this)","form-control form-control-sm","width:33%",t[a].AMOUNT);s.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");var m=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");"OFF"==r&&1!=t[a].IS_VIRTUAL&&(p.setAttribute("readonly","true"),u.setAttribute("disabled","true"),c.setAttribute("disabled","true"),m.setAttribute("disabled","true")),s.appendChild(p),s.appendChild(u),s.appendChild(m),s.appendChild(c);var b=document.createElement("div");b.setAttribute("style","display:flex"),b.appendChild(l),b.appendChild(s),o.appendChild(b),o.setAttribute("class","list-group-item"),t[a].AGAC.length>0&&o.appendChild(AgaciYaz(t[a].AGAC,t[a].RNDM_ID,n,t[a].IS_VIRTUAL)),i.appendChild(o)}return ulx.appendChild(i),i}function buttonCreator(t,e,n,a,r){var i=document.createElement("button");return i.innerText=r,n.length>0&&i.setAttribute(n,a),i.setAttribute("type","button"),i.setAttribute("class",e),t.length>0&&i.setAttribute("style",t),i}function inputCreator(t,e,n,a,r,i,o){var l=document.createElement("input");return l.setAttribute("type",t),l.setAttribute(n,a),l.setAttribute("class",r),l.setAttribute("style",i),l.setAttribute("value",o),l.setAttribute("name",e),l}function getitem(t){sonEleman=t,console.log(t)}function getDs(){$("#TreeArea").dxTreeList({dataSource:employees,rootValue:-1,keyExpr:"ID",parentIdExpr:"Head_ID",columns:[{dataField:"Title",caption:"Position"},"Full_Name","City","State","Mobile_Phone",{dataField:"Hire_Date",dataType:"date"}],expandedRowKeys:[1],showRowLines:!0,showBorders:!0,columnAutoWidth:!0})}function LoadSettings(){var t=document.createElement("table");for(let o=0;o<ProductDesingSetting.length;o++){var e=document.createElement("tr"),n=document.createElement("td");if("bool"==ProductDesingSetting[o].elementType){var a=document.createElement("div");a.setAttribute("class","custom-control custom-switch");var r=document.createElement("input");r.setAttribute("type","checkbox"),r.setAttribute("name",ProductDesingSetting[o].paramName),r.setAttribute("id",ProductDesingSetting[o].paramName),r.setAttribute("class","custom-control-input"),"OFF"==ProductDesingSetting[o].paramValue&&r.setAttribute("checked","true"),a.appendChild(r);var i=document.createElement("label");i.setAttribute("class","custom-control-label"),i.setAttribute("for",ProductDesingSetting[o].paramName),a.appendChild(i),n.appendChild(a)}e.appendChild(n);n=document.createElement("td");n.innerText=ProductDesingSetting[o].paramDescripton,e.appendChild(n),t.appendChild(e)}document.getElementById("settingsArea").appendChild(t)}function GetAjaxQuery(type,type_id){var CompanyInfo=new Object,url="/index.cfm?fuseaction=objects.get_qs_info&ajax=1&ajax_box_page=1&isAjax=1",myAjaxConnector=GetAjaxConnector();if(myAjaxConnector&&(data="type_id="+type_id+"&q_type="+type,myAjaxConnector.open("post",url+"&xmlhttp=1",!1),myAjaxConnector.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"),myAjaxConnector.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),myAjaxConnector.setRequestHeader("X-Requested-With","XMLHttpRequest"),myAjaxConnector.send(data),4==myAjaxConnector.readyState&&200==myAjaxConnector.status))try{CompanyInfo=eval(myAjaxConnector.responseText.replace(/\u200B/g,""))[0]}catch(t){CompanyInfo=!1}return CompanyInfo}function getParameterByName(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),a=n.exec(e);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}function OpenBasketProducts(t="",e="5"){var n=_compId,a=_compId,r=_priceCatId,i=_priceCatId;openBoxDraggable("http://erp.metosan.com.tr/index.cfm?fuseaction=objects.emptypopup_list_products_partner&price_cat="+r+"&PRICE_CATID="+i+"&company_id="+n+"&company_name="+a+"&columnsa="+t+"&actType="+e+"&question_id=")}function newDraft(){var t=prompt("Ürün Adı");idA=1e3,console.log("Yeni Taslak");var e=document.createElement("div");e.setAttribute("id","ppidarea");var n=document.createElement("ul");n.setAttribute("id",idA),n.setAttribute("data-is_virtual","1"),n.setAttribute("class","list-group"),idA++,e.appendChild(n);var a=document.getElementById("TreeArea");a.innerHTML="",a.appendChild(e),$("#pnamemain").val(t)}function AddRowItem(t,e,n,a,r,i,o,l,r,d,s){if(console.log(arguments),0==s){var u=document.getElementById("ppidarea").children[0],c=document.createElement("li");c.setAttribute("data-product_id",t),c.setAttribute("data-is_virtual",0),c.setAttribute("data-is_virtual",0),c.setAttribute("class","list-group-item"),c.setAttribute("data-idb",idB),idB++;var p=document.createElement("div");p.setAttribute("style","display:flex");var m=document.createElement("span");m.setAttribute("name","product_name_"),m.innerText=e,p.appendChild(m);var b=document.createElement("div");b.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");var A=inputCreator("text","amount","onchange","console.log(this)","form-control form-control-sm","width:33%",1);A.setAttribute("readonly","true");var g=buttonCreator("","btn btn-outline-success","","","+");g.setAttribute("disabled","true");var v=buttonCreator("","btn btn-outline-danger","onclick","remItem(this)","-"),h=u.getAttribute("data-is_virtual");1==parseInt(h)&&A.removeAttribute("readonly");var C=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");b.appendChild(A),b.appendChild(g),b.appendChild(C),b.appendChild(v),p.appendChild(b),c.appendChild(p),u.appendChild(c)}else{u=document.getElementById(s),c=document.createElement("li");c.setAttribute("data-product_id",t),c.setAttribute("data-is_virtual",0),c.setAttribute("data-is_virtual",0),c.setAttribute("class","list-group-item"),c.setAttribute("data-idb",idB),idB++;p=document.createElement("div");p.setAttribute("style","display:flex");m=document.createElement("span");m.setAttribute("name","product_name_"),m.innerText=e,p.appendChild(m);b=document.createElement("div");b.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");A=inputCreator("text","amount","onchange","console.log(this)","form-control form-control-sm","width:33%",1);A.setAttribute("readonly","true");g=buttonCreator("","btn btn-outline-success","","","+");g.setAttribute("disabled","true");v=buttonCreator("","btn btn-outline-danger","onclick","remItem(this)","-"),C=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");b.appendChild(A),b.appendChild(g),b.appendChild(C),b.appendChild(v),p.appendChild(b),c.appendChild(p),u.appendChild(c)}var _=wrk_query("SELECT * FROM PRODUCT_TREE WHERE STOCK_ID="+a,"dsn3");console.log(_.recordcount),_.recordcount>0&&ngetTree(a,0,"workcube_metosan_1","",2,c)}function AgacGetir(t,e=0){console.log(e),e++;var n=new Array;for(let u=0;u<t.length;u++){var a=t[u].getAttribute("data-product_id");obj=t[u];var r=$(obj).find("input[name='amount']")[0].value,i=$(obj).find("span[name='product_name_']")[0].innerText,o=new Object;o.PRODUCT_ID=a,o.PRODUCT_NAME=i,o.AMOUNT=r,o.AGAC=new Array;var l=t[u].children,d=!1;for(let t=0;t<l.length;t++)if("UL"==l[t].tagName){d=!0;var s=l[t].children}console.log(s),1==d&&(o.AGAC=AgacGetir(s,e)),n.push(o)}return SonAgac.push(n),n}function Kaydet(){var t=document.getElementById("ppidarea"),e=t.children[0].children;SonAgac.splice(0,SonAgac.length),AgacGetir(e),console.log(SonAgac)}function addProdMain(){openBoxDraggable("index.cfm?fuseaction=objects.emptypopup_add_vp_project")}function addProdMain_(){var t=document.getElementById("productNameVp").value,e=document.getElementById("productCatIdVp").value,n=document.createElement("li");n.setAttribute("data-product_id",0),n.setAttribute("data-is_virtual",1),n.setAttribute("class","list-group-item"),n.setAttribute("data-idb",idB),idB++;var a=document.createElement("span");a.setAttribute("name","product_name_"),a.innerText=t,a.setAttribute("data-product_catid",e);var r=document.createElement("div");r.setAttribute("style","display:flex"),r.appendChild(a);var i=document.createElement("div");i.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");var o=document.createElement("input");o.setAttribute("type","text"),o.setAttribute("onchange","console.log(this)"),o.setAttribute("class","form-control form-control-sm"),o.setAttribute("style","width:33%"),o.setAttribute("name","amount"),o.setAttribute("value",1),o.setAttribute("readonly","true");var l=document.createElement("button");l.setAttribute("type","button"),l.setAttribute("class","btn btn-outline-success"),l.setAttribute("onclick","OpenBasketProducts_Pars(this)"),l.innerText="+";var d=document.createElement("button");d.innerText="-",d.setAttribute("onclick","remItem(this)"),d.setAttribute("type","button"),d.setAttribute("class","btn btn-outline-danger");var s=document.createElement("button");s.innerText="VP",s.setAttribute("onclick","addProdSub(this)"),s.setAttribute("type","button"),s.setAttribute("class","btn btn-outline-warning");var u=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");i.appendChild(o),i.appendChild(l),i.appendChild(s),i.appendChild(u),i.appendChild(d),r.appendChild(i),n.appendChild(r);var c=document.getElementById("ppidarea").children[0];c.appendChild(n),agacGosterEkle(),sortableYap()}function OpenBasketProducts_Pars(t){var e,n=t.parentElement.parentElement.parentElement.children;console.log(n);for(let t=0;t<n.length;t++){var a=n[t];"UL"==a.tagName&&(e=a)}if(console.log(e),null!=e){var r=e.getAttribute("id");OpenBasketProducts(r,"5")}else{var i=document.createElement("ul");i.setAttribute("id",idA),i.setAttribute("data-is_virtual",1),i.setAttribute("class","list-group");n=t.parentElement.parentElement.parentElement;n.appendChild(i),OpenBasketProducts(idA,"5"),idA++}}function addProdSub(t){var e,n=t.parentElement.parentElement.parentElement.children;console.log(n);for(let t=0;t<n.length;t++){var a=n[t];"UL"==a.tagName&&(e=a)}console.log(e);var r=document.createElement("li");r.setAttribute("data-product_id",0),r.setAttribute("data-is_virtual",1),r.setAttribute("class","list-group-item"),r.setAttribute("data-idb",idB),idB++;var i=document.createElement("span");i.setAttribute("name","product_name_"),i.innerText=prompt("Ürün Adı");var o=document.createElement("div");o.setAttribute("style","display:flex"),o.appendChild(i);var l=document.createElement("div");l.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");var d=document.createElement("input");d.setAttribute("type","text"),d.setAttribute("onchange","console.log(this)"),d.setAttribute("class","form-control form-control-sm"),d.setAttribute("style","width:33%"),d.setAttribute("name","amount"),d.setAttribute("value",1),d.setAttribute("readonly","true");var s=document.createElement("button");s.setAttribute("type","button"),s.setAttribute("class","btn btn-outline-success"),s.setAttribute("onclick","OpenBasketProducts_Pars(this)"),s.innerText="+";var u=document.createElement("button");u.innerText="-",u.setAttribute("onclick","remItem(this)"),u.setAttribute("type","button"),u.setAttribute("class","btn btn-outline-danger");var c=document.createElement("button");c.innerText="VP",c.setAttribute("onclick","addProdSub(this)"),c.setAttribute("type","button"),c.setAttribute("class","btn btn-outline-warning");var p=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");l.appendChild(d),l.appendChild(s),l.appendChild(c),l.appendChild(p),l.appendChild(u),o.appendChild(l),r.appendChild(o),null==e?(e=document.createElement("ul"),e.setAttribute("class","list-group"),e.setAttribute("id",idA),idA++,e.appendChild(r),t.parentElement.parentElement.parentElement.appendChild(e)):e.appendChild(r),agacGosterEkle(),sortableYap()}function getCats(t,e){console.log(e);var n=!1;if("change"==e.type?t.value.length>3&&(n=!0):"keyup"==e.type&&t.value.length>3&&13==e.keyCode&&(n=!0),n){var a=wrk_query("SELECT * FROM PRODUCT_CAT WHERE PRODUCT_CAT LIKE '%"+t.value+"%' OR HIERARCHY LIKE '%"+t.value+"%'","dsn3");if(a.recordcount>0){var r=document.getElementById("tblCat");$("#tblCat").html(""),r.innerHtml="";for(let t=0;t<a.recordcount;t++){var i=a.PRODUCT_CATID[t],o=a.PRODUCT_CAT[t],l=a.HIERARCHY[t],d=document.createElement("tr"),s=document.createElement("td"),u=document.createElement("a");u.setAttribute("href","javascript://"),u.setAttribute("onclick","setCat("+i+",'"+o+"')"),u.innerText=l,s.appendChild(u),d.appendChild(s);s=document.createElement("td"),u=document.createElement("a");u.setAttribute("href","javascript://"),u.setAttribute("onclick","setCat("+i+",'"+o+"')"),u.innerText=o,s.appendChild(u),d.appendChild(s),r.appendChild(d)}}$("#catRdiv").show(500)}}function setCat(t,e){$("#productCatIdVp").val(t),$("#productCatVp").val(e),$("#catRdiv").hide(500)}function loadQuestions(){var t="SELECT QUESTION_ID,QUESTION FROM VIRTUAL_PRODUCT_TREE_QUESTIONS",e=wrk_query(t,"dsn3");$("#saquestion").html("");var n=document.createElement("option");n.setAttribute("value",""),n.innerText="Alternatif Sorusu",document.getElementById("saquestion").appendChild(n);for(let t=0;t<e.recordcount;t++){var a=e.QUESTION_ID[t],r=e.QUESTION[t];n=document.createElement("option");n.setAttribute("value",a),n.innerText=r,document.getElementById("saquestion").appendChild(n)}}function addAltrnativeQ(t,e){openBoxDraggable("index.cfm?fuseaction=objects.emptypopup_add_alternative_question_pbs")}function saveAlternative(t,e){var n=document.getElementById("questionName").value;$.ajax({url:"/AddOns/Partner/cfc/generalFunctions.cfc?method=saveAlternative&QUESTION_NAME="+n+"&dsn3="+t,success:function(t){console.log(t),closeBoxDraggable(e),loadQuestions()}})}function agacGosterEkle(){var t=$("#ppidarea *ul");for(let r=0;r<t.length;r++){var e=t[r].parentElement;if(console.log(e.tagName),"LI"==e.tagName){var n=document.createElement("button"),a=document.createElement("i");a.setAttribute("class","icn-md icon-down"),n.setAttribute("class","btn btn-sm btn-link"),n.appendChild(a),n.setAttribute("onclick","$(this.parentElement.parentElement.lastChild).toggle(500)"),console.log(n),e.children[0].prepend(n)}}}function sortableYap(){$("#ppidarea *ul").sortable({connectWith:".list-group",sort:function(t,e){console.log("sort")},start:function(t,e){console.log("start")},stop:function(t,e){console.log("stop")},update:function(t,e){console.log("update")},receive:function(t,e){console.log("receive"),console.log(e.sender[0]),console.log(t.target)}});return!0}function virtuallariYerlestir(){var t=$("#ppidarea *ul");for(let r=0;r<t.length;r++){var e=t[r].parentElement;if("ppidarea"==e.getAttribute("id")){console.log("ek"),t[r].setAttribute("data-is_virtual","1");var n=$(t[r]).find("input[name='amount']");console.log(n),n.removeAttr("readonly")}else{var a=e.getAttribute("data-is_virtual");if(1==parseInt(a)){console.log(a),t[r].setAttribute("data-is_virtual","1");n=$(t[r]).find("input[name='amount']");console.log(n),n.removeAttr("readonly")}else{n=$(t[r]).find("input[name='amount']");console.log(n),n.attr("readonly","true")}}}}function AgaciYaz_12(t,e,n="0",a="1",r){var i=ProductDesingSetting.find(t=>"update_real_product"==t.paramName).paramValue,o=document.createElement("ul");o.setAttribute("class","list-group"),o.setAttribute("data-is_virtual",a),o.setAttribute("data-seviye",e),o.setAttribute("id",idA),idA+=1;n=n;n+=e.toString();for(let a=0;a<t.length;a++){r=document.createElement("li");e<=0&&(e=t[a].RNDM_ID);var l=document.createElement("span");l.setAttribute("name","product_name_");var d=VIRTUAL_PRODUCT_TREE_QUESTIONS.find(e=>e.QUESTION_ID==t[a].QUESTION_ID);t[a].PRODUCT_NAME;d=null!=d?"<span style='color:var(--danger)'>("+d.QUESTION+")</span>":"",l.innerHTML=t[a].PRODUCT_NAME+" "+d,r.setAttribute("data-product_id",t[a].PRODUCT_ID),r.setAttribute("data-IS_VIRTUAL",t[a].IS_VIRTUAL),o.setAttribute("data-IS_VIRTUAL",t[a].IS_VIRTUAL),r.setAttribute("data-PRODUCT_TREE_ID",t[a].PRODUCT_TREE_ID),r.setAttribute("data-question_id",t[a].QUESTION_ID),r.setAttribute("data-idb",idB),idB++;var s=document.createElement("div"),u=buttonCreator("","btn btn-outline-success","onclick","getitem(this)","+"),c=buttonCreator("","btn btn-outline-danger","onclick","remItem(this)","-"),p=inputCreator("text","amount","onchange","console.log(this)","form-control form-control-sm","width:33%",t[a].AMOUNT);s.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");var m=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");"OFF"==i&&1!=t[a].IS_VIRTUAL&&(p.setAttribute("readonly","true"),u.setAttribute("disabled","true"),c.setAttribute("disabled","true"),m.setAttribute("disabled","true")),s.appendChild(p),s.appendChild(u),s.appendChild(m),s.appendChild(c);var b=document.createElement("div");b.setAttribute("style","display:flex"),b.appendChild(l),b.appendChild(s),r.appendChild(b),r.setAttribute("class","list-group-item"),t[a].AGAC.length>0&&r.appendChild(AgaciYaz_12(t[a].AGAC,t[a].RNDM_ID,n,t[a].IS_VIRTUAL)),o.appendChild(r)}return o}function UrunKaydet(){SonAgac[SonAgac.length-1],$("#pnamemain").val(),$("#vp_id").val(),$("#is_virtual").val(),$("#project_id").val(),$("#pstage").val()}var o=new Object,ulx=document.createElement("div");ulx.setAttribute("id","ppidarea");var sonEleman="",_compId,_priceCatId,SonAgac=new Array,idA=1e3,isUpdated=!1,idB=5e3;$(document).ready(function(){var t=document.getElementById("wrk_main_layout");t.removeAttribute("class"),t.setAttribute("class","container-fluid"),LoadSettings();var e=getParameterByName("project_id"),n=wrk_query("select COMPANY_ID FROM PRO_PROJECTS WHERE PROJECT_ID="+e,"DSN").COMPANY_ID[0];let a=GetAjaxQuery("CompanyInfo",n);_priceCatId=a.PRICE_LISTS.find(t=>1==t.IS_DEFAULT).PRICE_CATID,_compId=n});