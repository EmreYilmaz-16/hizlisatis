function ngetTree(t,e,a,n,r=1,i="",d="",u=""){if(1==r){n.parentElement.children[0].innerText;$("#pnamemain").val(d),$("#vp_id").val(t),$("#is_virtual").val(e),$("#pstage").val(u),$.ajax({url:"/AddOns/Partner/project/cfc/product_design.cfc?method=getTree&product_id="+t+"&isVirtual="+e+"&ddsn3="+a+"&company_id="+_compId+"&price_catid="+_priceCatId,success:function(e){var a=strToJson(e);o=JSON.parse(a),AgaciYaz(o,0,"0",1);var n=document.getElementById("TreeArea");n.innerHTML="",n.appendChild(ulx),agacGosterEkle(),sortableYap(),virtuallariYerlestir(),MaliyetHesapla(),GercekKontrol(t)}})}else 2==r?$.ajax({url:"/AddOns/Partner/project/cfc/product_design.cfc?method=getTree&product_id="+t+"&isVirtual="+e+"&ddsn3="+a+"&company_id="+_compId+"&price_catid="+_priceCatId,success:function(t){var e=strToJson(t);o=JSON.parse(e);var a=AgaciYaz_12(o,0,"",0);i.appendChild(a),agacGosterEkle(),sortableYap(),virtuallariYerlestir(),MaliyetHesapla()}}):3==r&&$.ajax({url:"/AddOns/Partner/project/cfc/product_design.cfc?method=getTree&product_id="+t+"&isVirtual="+e+"&ddsn3="+a+"&company_id="+_compId+"&price_catid="+_priceCatId,success:function(t){var e=strToJson(t);o=JSON.parse(e),agacGosterEkle(),sortableYap(),virtuallariYerlestir(),MaliyetHesapla()}})}function patnerEkle(t){}function strToJson(t){var e="";for(let n=0;n<t.length;n++){var a=t.charAt(n).trim();","==a&&"]"==t.charAt(n+1).trim()&&(a=""),e+=a}return e}function AgaciYaz(t,e,a="0",n="1"){var r=ProductDesingSetting.find(t=>"update_real_product"==t.paramName).paramValue;ulx.innerHTML="";var i=document.createElement("ul");i.setAttribute("class","list-group"),i.setAttribute("data-is_virtual",n),i.setAttribute("data-seviye",e),i.setAttribute("id",idA),idA+=1;a=a;a+=e.toString();for(let n=0;n<t.length;n++){var d=document.createElement("li");e<=0&&(e=t[n].RNDM_ID);var o=document.createElement("span");o.setAttribute("name","product_name_");var u=VIRTUAL_PRODUCT_TREE_QUESTIONS.find(e=>e.QUESTION_ID==t[n].QUESTION_ID);t[n].PRODUCT_NAME;u=null!=u?"<span style='color:var(--danger)'>("+u.QUESTION+")</span>":"",o.innerHTML=t[n].PRODUCT_NAME+" "+u,console.log(t[n]),d.setAttribute("data-product_id",t[n].PRODUCT_ID),d.setAttribute("data-stock_id",t[n].STOCK_ID),d.setAttribute("data-price",t[n].PRICE),d.setAttribute("data-other_money",t[n].MONEY),d.setAttribute("data-discount",t[n].DISCOUNT),d.setAttribute("data-IS_VIRTUAL",t[n].IS_VIRTUAL),d.setAttribute("data-PRODUCT_TREE_ID",t[n].PRODUCT_TREE_ID),d.setAttribute("data-question_id",t[n].QUESTION_ID),d.setAttribute("data-idb",idB),idB++;var l=document.createElement("div"),s=buttonCreator("","btn btn-outline-success","onclick","getitem(this)","+"),c=buttonCreator("","btn btn-outline-danger","onclick","remItem(this)","-"),p=inputCreator("text","amount","onchange","MaliyetHesapla();","form-control form-control-sm","width:33%",t[n].AMOUNT);l.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");var m=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");"OFF"==r&&1!=t[n].IS_VIRTUAL&&(p.setAttribute("readonly","true"),s.setAttribute("disabled","true"),c.setAttribute("disabled","true"),m.setAttribute("disabled","true")),l.appendChild(p),l.appendChild(s),l.appendChild(m),l.appendChild(c);var b=document.createElement("div");b.setAttribute("style","display:flex"),b.appendChild(o),b.appendChild(l),d.appendChild(b),d.setAttribute("class","list-group-item"),t[n].AGAC.length>0&&d.appendChild(AgaciYaz(t[n].AGAC,t[n].RNDM_ID,a,t[n].IS_VIRTUAL)),i.appendChild(d)}return ulx.appendChild(i),i}function buttonCreator(t,e,a,n,r){var i=document.createElement("button");return i.innerText=r,a.length>0&&i.setAttribute(a,n),i.setAttribute("type","button"),i.setAttribute("class",e),t.length>0&&i.setAttribute("style",t),i}function inputCreator(t,e,a,n,r,i,d){var o=document.createElement("input");return o.setAttribute("type",t),o.setAttribute(a,n),o.setAttribute("class",r),o.setAttribute("style",i),o.setAttribute("value",d),o.setAttribute("name",e),o}function getitem(t){sonEleman=t}function getDs(){$("#TreeArea").dxTreeList({dataSource:employees,rootValue:-1,keyExpr:"ID",parentIdExpr:"Head_ID",columns:[{dataField:"Title",caption:"Position"},"Full_Name","City","State","Mobile_Phone",{dataField:"Hire_Date",dataType:"date"}],expandedRowKeys:[1],showRowLines:!0,showBorders:!0,columnAutoWidth:!0})}function LoadSettings(){$("#settingsArea").html("");var t=document.createElement("table");for(let d=0;d<ProductDesingSetting.length;d++){var e=document.createElement("tr"),a=document.createElement("td");if("bool"==ProductDesingSetting[d].elementType){var n=document.createElement("div");n.setAttribute("class","custom-control custom-switch"),n.setAttribute("onclick","setSettings(this)"),n.setAttribute("data-paramName",ProductDesingSetting[d].paramName),n.setAttribute("data-paramValue",ProductDesingSetting[d].paramValue);var r=document.createElement("input");r.setAttribute("type","checkbox"),r.setAttribute("name",ProductDesingSetting[d].paramName),r.setAttribute("id",ProductDesingSetting[d].paramName),r.setAttribute("class","custom-control-input"),"ON"==ProductDesingSetting[d].paramValue&&r.setAttribute("checked","true"),n.appendChild(r);var i=document.createElement("label");i.setAttribute("class","custom-control-label"),i.setAttribute("for",ProductDesingSetting[d].paramName),n.appendChild(i),a.appendChild(n)}e.appendChild(a);a=document.createElement("td");a.innerText=ProductDesingSetting[d].paramDescripton,e.appendChild(a),t.appendChild(e)}document.getElementById("settingsArea").appendChild(t)}function GetAjaxQuery(type,type_id){var CompanyInfo=new Object,url="/index.cfm?fuseaction=objects.get_qs_info&ajax=1&ajax_box_page=1&isAjax=1",myAjaxConnector=GetAjaxConnector();if(myAjaxConnector&&(data="type_id="+type_id+"&q_type="+type,myAjaxConnector.open("post",url+"&xmlhttp=1",!1),myAjaxConnector.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"),myAjaxConnector.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),myAjaxConnector.setRequestHeader("X-Requested-With","XMLHttpRequest"),myAjaxConnector.send(data),4==myAjaxConnector.readyState&&200==myAjaxConnector.status))try{CompanyInfo=eval(myAjaxConnector.responseText.replace(/\u200B/g,""))[0]}catch(t){CompanyInfo=!1}return CompanyInfo}function getParameterByName(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),n=a.exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function OpenBasketProducts(t="",e="5"){var a=_compId,n=_compId,r=_priceCatId,i=_priceCatId;openBoxDraggable("http://erp.metosan.com.tr/index.cfm?fuseaction=objects.emptypopup_list_products_partner&price_cat="+r+"&PRICE_CATID="+i+"&company_id="+a+"&company_name="+n+"&columnsa="+t+"&actType="+e+"&question_id=")}function newDraft(){var t=prompt("Ürün Adı");if(null==t||0==t.trim().length)return!1;idA=1e3;var e=getParameterByName("project_id"),a="select * from workcube_metosan_1.GetCatParamsPBS where PROJECT_ID="+e,n=wrk_query(a,"dsn3"),r=n.PRODUCT_CATID[0],i=n.PRODUCT_UNIT[0];$.ajax({url:"/AddOns/Partner/project/cfc/product_design.cfc?method=NewDraft&PRODUCT_NAME="+t+"&PRODUCT_CATID="+r+"&PRODUCT_UNIT="+i+"&PROJECT_ID="+e+"&ddsn3=workcube_metosan_1",success:function(t){getProjectProducts(e)}})}function AddRowItem(t,e,a,n,r,i,d,o,r,u,l){if(0==l){var s=document.getElementById("ppidarea").children[0],c=document.createElement("li");c.setAttribute("data-product_id",t),c.setAttribute("data-stock_id",n),c.setAttribute("data-is_virtual",0),c.setAttribute("data-price",r),c.setAttribute("data-other_money",d),c.setAttribute("data-discount",i),c.setAttribute("class","list-group-item"),c.setAttribute("data-idb",idB),idB++;var p=document.createElement("div");p.setAttribute("style","display:flex");var m=document.createElement("span");m.setAttribute("name","product_name_"),m.innerText=e,p.appendChild(m);var b=document.createElement("div");b.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");var A=inputCreator("text","amount","onchange","MaliyetHesapla();","form-control form-control-sm","width:33%",1);A.setAttribute("readonly","true");var _=buttonCreator("","btn btn-outline-success","","","+");_.setAttribute("disabled","true");var g=buttonCreator("","btn btn-outline-danger","onclick","remItem(this)","-"),C=s.getAttribute("data-is_virtual");1==parseInt(C)&&A.removeAttribute("readonly");var h=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");b.appendChild(A),b.appendChild(_),b.appendChild(h),b.appendChild(g),p.appendChild(b),c.appendChild(p),s.appendChild(c)}else{s=document.getElementById(l),c=document.createElement("li");c.setAttribute("data-product_id",t),c.setAttribute("data-stock_id",n),c.setAttribute("data-is_virtual",0),c.setAttribute("data-is_virtual",0),c.setAttribute("data-price",r),c.setAttribute("data-other_money",d),c.setAttribute("data-discount",i),c.setAttribute("class","list-group-item"),c.setAttribute("data-idb",idB),idB++;p=document.createElement("div");p.setAttribute("style","display:flex");m=document.createElement("span");m.setAttribute("name","product_name_"),m.innerText=e,p.appendChild(m);b=document.createElement("div");b.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");A=inputCreator("text","amount","onchange","MaliyetHesapla();","form-control form-control-sm","width:33%",1);A.setAttribute("readonly","true");_=buttonCreator("","btn btn-outline-success","","","+");_.setAttribute("disabled","true");g=buttonCreator("","btn btn-outline-danger","onclick","remItem(this)","-"),h=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");b.appendChild(A),b.appendChild(_),b.appendChild(h),b.appendChild(g),p.appendChild(b),c.appendChild(p),s.appendChild(c)}var v=wrk_query("SELECT * FROM PRODUCT_TREE WHERE STOCK_ID="+n,"dsn3");v.recordcount>0&&ngetTree(n,0,"workcube_metosan_1","",2,c),MaliyetHesapla()}function AddRowItemVirtual(t,e,a,n,r,i,d,o,r,u,l){if(0==l){var s=document.getElementById("ppidarea").children[0],c=document.createElement("li");c.setAttribute("data-product_id",t),c.setAttribute("data-stock_id",n),c.setAttribute("data-is_virtual",1),c.setAttribute("data-price",r),c.setAttribute("data-other_money",d),c.setAttribute("data-discount",i),c.setAttribute("class","list-group-item"),c.setAttribute("data-idb",idB),idB++;var p=document.createElement("div");p.setAttribute("style","display:flex");var m=document.createElement("span");m.setAttribute("name","product_name_"),m.innerText=e,p.appendChild(m);var b=document.createElement("div");b.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");var A=inputCreator("text","amount","onchange","MaliyetHesapla();","form-control form-control-sm","width:33%",1);A.setAttribute("readonly","true");var _=buttonCreator("","btn btn-outline-success","","","+");_.setAttribute("disabled","true");var g=buttonCreator("","btn btn-outline-danger","onclick","remItem(this)","-"),C=s.getAttribute("data-is_virtual");1==parseInt(C)&&A.removeAttribute("readonly");var h=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");b.appendChild(A),b.appendChild(_),b.appendChild(h),b.appendChild(g),p.appendChild(b),c.appendChild(p),s.appendChild(c)}else{s=document.getElementById(l),c=document.createElement("li");c.setAttribute("data-product_id",t),c.setAttribute("data-stock_id",n),c.setAttribute("data-is_virtual",1),c.setAttribute("data-is_virtual",1),c.setAttribute("data-price",r),c.setAttribute("data-other_money",d),c.setAttribute("data-discount",i),c.setAttribute("class","list-group-item"),c.setAttribute("data-idb",idB),idB++;p=document.createElement("div");p.setAttribute("style","display:flex");m=document.createElement("span");m.setAttribute("name","product_name_"),m.innerText=e,p.appendChild(m);b=document.createElement("div");b.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");A=inputCreator("text","amount","onchange","MaliyetHesapla();","form-control form-control-sm","width:33%",1);A.setAttribute("readonly","true");_=buttonCreator("","btn btn-outline-success","","","+");_.setAttribute("disabled","true");g=buttonCreator("","btn btn-outline-danger","onclick","remItem(this)","-"),h=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");b.appendChild(A),b.appendChild(_),b.appendChild(h),b.appendChild(g),p.appendChild(b),c.appendChild(p),s.appendChild(c)}var v=wrk_query("SELECT * FROM VIRTUAL_PRODUCT_TREE_PRT WHERE VP_ID="+n,"dsn3");v.recordcount>0&&ngetTree(n,1,"workcube_metosan_1","",2,c),MaliyetHesapla()}function AgacGetir(t,e=0){e++;var a=new Array;for(let g=0;g<t.length;g++){var n=t[g].getAttribute("data-product_id"),r=t[g].getAttribute("data-stock_id"),i=t[g].getAttribute("data-product_catid"),d=t[g].getAttribute("data-is_virtual"),o=t[g].getAttribute("data-question_id"),u=t[g].getAttribute("data-price"),l=t[g].getAttribute("data-other_money"),s=t[g].getAttribute("data-discount");obj=t[g];var c=$(obj).find("input[name='amount']")[0].value,p=$(obj).find("span[name='product_name_']")[0].innerText,m=new Object;m.PRODUCT_ID=n,m.PRODUCT_NAME=p,m.AMOUNT=c,m.IS_VIRTUAL=d,m.STOCK_ID=r,m.QUESTION_ID=o,m.PRICE=u,m.MONEY=l,m.DISCOUNT=s,m.PRODUCT_CATID=null!=i?i:0,m.PRODUCT_TREE=new Array;var b=t[g].children,A=!1;for(let t=0;t<b.length;t++)if("UL"==b[t].tagName){A=!0;var _=b[t].children}1==A&&(m.AGAC=AgacGetir(_,e)),a.push(m)}return SonAgac.push(a),a}function Kaydet(){var t=document.getElementById("ppidarea"),e=t.children[0].children;SonAgac.splice(0,SonAgac.length),AgacGetir(e),UrunKaydet()}function addProdMain(t=0){openBoxDraggable("index.cfm?fuseaction=objects.emptypopup_add_vp_project&idb="+t)}function addProdMain_(t,e){var a=document.getElementById("productNameVp").value,n=document.getElementById("productCatIdVp").value,r=document.createElement("li");r.setAttribute("data-product_id",0),r.setAttribute("data-stock_id",0),r.setAttribute("data-is_virtual",1),r.setAttribute("class","list-group-item"),r.setAttribute("data-idb",idB),idB++;var i=document.createElement("span");i.setAttribute("name","product_name_"),i.innerText=a,r.setAttribute("data-product_catid",n);var d=document.createElement("div");d.setAttribute("style","display:flex"),d.appendChild(i);var o=document.createElement("div");o.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");var u=document.createElement("input");u.setAttribute("type","text"),u.setAttribute("onchange","MaliyetHesapla();"),u.setAttribute("class","form-control form-control-sm"),u.setAttribute("style","width:33%"),u.setAttribute("name","amount"),u.setAttribute("value",1),u.setAttribute("readonly","true");var l=document.createElement("button");l.setAttribute("type","button"),l.setAttribute("class","btn btn-outline-success"),l.setAttribute("onclick","OpenBasketProducts_Pars(this)"),l.innerText="+";var s=document.createElement("button");s.innerText="-",s.setAttribute("onclick","remItem(this)"),s.setAttribute("type","button"),s.setAttribute("class","btn btn-outline-danger");var c=document.createElement("button");c.innerText="VP",c.setAttribute("onclick","addProdSub(this)"),c.setAttribute("type","button"),c.setAttribute("class","btn btn-outline-warning");var p=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");if(o.appendChild(u),o.appendChild(l),o.appendChild(c),o.appendChild(p),o.appendChild(s),d.appendChild(o),r.appendChild(d),0==t){var m=document.getElementById("ppidarea").children[0];m.appendChild(r)}else{var b=document.createElement("ul");b.setAttribute("id",idA),b.setAttribute("data-is_virtual",1),b.setAttribute("class","list-group"),idA++,b.appendChild(r),document.getElementByIdb(t).appendChild(b)}agacGosterEkle(),sortableYap(),MaliyetHesapla(),closeBoxDraggable(e)}function OpenBasketProducts_Pars(t){var e,a=t.parentElement.parentElement.parentElement.children;for(let t=0;t<a.length;t++){var n=a[t];"UL"==n.tagName&&(e=n)}if(null!=e){var r=e.getAttribute("id");OpenBasketProducts(r,"5")}else{var i=document.createElement("ul");i.setAttribute("id",idA),i.setAttribute("data-is_virtual",1),i.setAttribute("class","list-group");a=t.parentElement.parentElement.parentElement;a.appendChild(i),OpenBasketProducts(idA,"5"),idA++}}function addProdSub(t){var e=t.parentElement.parentElement.parentElement.getAttribute("data-idb");addProdMain(e)}function addProdSub_(t){var e,a=t.parentElement.parentElement.parentElement.children;for(let t=0;t<a.length;t++){var n=a[t];"UL"==n.tagName&&(e=n)}var r=document.createElement("li");r.setAttribute("data-product_id",0),r.setAttribute("data-stock_id",0),r.setAttribute("data-is_virtual",1),r.setAttribute("class","list-group-item"),r.setAttribute("data-idb",idB),idB++;var i=document.createElement("span");i.setAttribute("name","product_name_"),i.innerText=prompt("Ürün Adı");var d=document.createElement("div");d.setAttribute("style","display:flex"),d.appendChild(i);var o=document.createElement("div");o.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");var u=document.createElement("input");u.setAttribute("type","text"),u.setAttribute("onchange","MaliyetHesapla();"),u.setAttribute("class","form-control form-control-sm"),u.setAttribute("style","width:33%"),u.setAttribute("name","amount"),u.setAttribute("value",1),u.setAttribute("readonly","true");var l=document.createElement("button");l.setAttribute("type","button"),l.setAttribute("class","btn btn-outline-success"),l.setAttribute("onclick","OpenBasketProducts_Pars(this)"),l.innerText="+";var s=document.createElement("button");s.innerText="-",s.setAttribute("onclick","remItem(this)"),s.setAttribute("type","button"),s.setAttribute("class","btn btn-outline-danger");var c=document.createElement("button");c.innerText="VP",c.setAttribute("onclick","addProdSub(this)"),c.setAttribute("type","button"),c.setAttribute("class","btn btn-outline-warning");var p=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");o.appendChild(u),o.appendChild(l),o.appendChild(c),o.appendChild(p),o.appendChild(s),d.appendChild(o),r.appendChild(d),null==e?(e=document.createElement("ul"),e.setAttribute("class","list-group"),e.setAttribute("id",idA),idA++,e.appendChild(r),t.parentElement.parentElement.parentElement.appendChild(e)):e.appendChild(r),agacGosterEkle(),sortableYap(),MaliyetHesapla()}function getCats(t,e){var a=!1;if("change"==e.type?t.value.length>3&&(a=!0):"keyup"==e.type&&t.value.length>3&&13==e.keyCode&&(a=!0),a){var n=wrk_query("SELECT * FROM PRODUCT_CAT WHERE PRODUCT_CAT LIKE '%"+t.value+"%' OR HIERARCHY LIKE '%"+t.value+"%'","dsn3");if(n.recordcount>0){var r=document.getElementById("tblCat");$("#tblCat").html(""),r.innerHtml="";for(let t=0;t<n.recordcount;t++){var i=n.PRODUCT_CATID[t],d=n.PRODUCT_CAT[t],o=n.HIERARCHY[t],u=document.createElement("tr"),l=document.createElement("td"),s=document.createElement("a");s.setAttribute("href","javascript://"),s.setAttribute("onclick","setCat("+i+",'"+d+"')"),s.innerText=o,l.appendChild(s),u.appendChild(l);l=document.createElement("td"),s=document.createElement("a");s.setAttribute("href","javascript://"),s.setAttribute("onclick","setCat("+i+",'"+d+"')"),s.innerText=d,l.appendChild(s),u.appendChild(l),r.appendChild(u)}}$("#catRdiv").show(500)}}function setCat(t,e){$("#productCatIdVp").val(t),$("#productCatVp").val(e),$("#catRdiv").hide(500)}function loadQuestions(){var t="SELECT QUESTION_ID,QUESTION FROM VIRTUAL_PRODUCT_TREE_QUESTIONS",e=wrk_query(t,"dsn3");$("#saquestion").html("");var a=document.createElement("option");a.setAttribute("value",""),a.innerText="Alternatif Sorusu",document.getElementById("saquestion").appendChild(a);for(let t=0;t<e.recordcount;t++){var n=e.QUESTION_ID[t],r=e.QUESTION[t];a=document.createElement("option");a.setAttribute("value",n),a.innerText=r,document.getElementById("saquestion").appendChild(a)}}function addAltrnativeQ(t,e){openBoxDraggable("index.cfm?fuseaction=objects.emptypopup_add_alternative_question_pbs")}function saveAlternative(t,e){var a=document.getElementById("questionName").value;$.ajax({url:"/AddOns/Partner/cfc/generalFunctions.cfc?method=saveAlternative&QUESTION_NAME="+a+"&dsn3="+t,success:function(t){closeBoxDraggable(e),loadQuestions()}})}function agacGosterEkle(){var t=$("#ppidarea *ul");for(let r=0;r<t.length;r++){var e=t[r].parentElement;if("LI"==e.tagName){var a=document.createElement("button"),n=document.createElement("i");n.setAttribute("class","icn-md icon-down"),a.setAttribute("class","btn btn-sm btn-link"),a.appendChild(n),a.setAttribute("onclick","$(this.parentElement.parentElement.lastChild).toggle(500)"),e.children[0].prepend(a)}}}function sortableYap(){$("#ppidarea *ul").sortable({connectWith:".list-group",sort:function(t,e){console.log("sort")},start:function(t,e){console.log("start")},stop:function(t,e){console.log("stop")},update:function(t,e){console.log("update")},receive:function(t,e){console.log("receive"),console.log(e.sender[0]),console.log(t.target)}});return!0}function virtuallariYerlestir(){var t=$("#ppidarea *ul");for(let r=0;r<t.length;r++){var e=t[r].parentElement;if("ppidarea"==e.getAttribute("id")){t[r].setAttribute("data-is_virtual","1");var a=$(t[r]).find("input[name='amount']");a.removeAttr("readonly")}else{var n=e.getAttribute("data-is_virtual");if(1==parseInt(n)){t[r].setAttribute("data-is_virtual","1");a=$(t[r]).find("input[name='amount']");a.removeAttr("readonly")}else{a=$(t[r]).find("input[name='amount']");a.attr("readonly","true")}}}}function AgaciYaz_12(t,e,a="0",n="1",r){var i=ProductDesingSetting.find(t=>"update_real_product"==t.paramName).paramValue,d=document.createElement("ul");d.setAttribute("class","list-group"),d.setAttribute("data-is_virtual",n),d.setAttribute("data-seviye",e),d.setAttribute("id",idA),idA+=1;a=a;a+=e.toString();for(let n=0;n<t.length;n++){r=document.createElement("li");e<=0&&(e=t[n].RNDM_ID);var o=document.createElement("span");o.setAttribute("name","product_name_");var u=VIRTUAL_PRODUCT_TREE_QUESTIONS.find(e=>e.QUESTION_ID==t[n].QUESTION_ID);t[n].PRODUCT_NAME;u=null!=u?"<span style='color:var(--danger)'>("+u.QUESTION+")</span>":"",o.innerHTML=t[n].PRODUCT_NAME+" "+u,r.setAttribute("data-product_id",t[n].PRODUCT_ID),r.setAttribute("data-stock_id",t[n].STOCK_ID),r.setAttribute("data-IS_VIRTUAL",t[n].IS_VIRTUAL),d.setAttribute("data-IS_VIRTUAL",t[n].IS_VIRTUAL),r.setAttribute("data-PRODUCT_TREE_ID",t[n].PRODUCT_TREE_ID),r.setAttribute("data-question_id",t[n].QUESTION_ID),r.setAttribute("data-idb",idB),idB++;var l=document.createElement("div"),s=buttonCreator("","btn btn-outline-success","onclick","getitem(this)","+"),c=buttonCreator("","btn btn-outline-danger","onclick","remItem(this)","-"),p=inputCreator("text","amount","onchange","MaliyetHesapla();","form-control form-control-sm","width:33%",t[n].AMOUNT);l.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");var m=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");"OFF"==i&&1!=t[n].IS_VIRTUAL&&(p.setAttribute("readonly","true"),s.setAttribute("disabled","true"),c.setAttribute("disabled","true"),m.setAttribute("disabled","true")),l.appendChild(p),l.appendChild(s),l.appendChild(m),l.appendChild(c);var b=document.createElement("div");b.setAttribute("style","display:flex"),b.appendChild(o),b.appendChild(l),r.appendChild(b),r.setAttribute("class","list-group-item"),t[n].AGAC.length>0&&r.appendChild(AgaciYaz_12(t[n].AGAC,t[n].RNDM_ID,a,t[n].IS_VIRTUAL)),d.appendChild(r)}return d}function AgaciYaz_13(t,e,a="0",n="1",r){var i=ProductDesingSetting.find(t=>"update_real_product"==t.paramName).paramValue,d=document.createElement("ul");d.setAttribute("class","list-group"),d.setAttribute("data-is_virtual",n),d.setAttribute("data-seviye",e),d.setAttribute("id",idA),idA+=1;a=a;a+=e.toString();for(let n=0;n<t.length;n++){r=document.createElement("li");e<=0&&(e=t[n].RNDM_ID);var o=document.createElement("span");o.setAttribute("name","product_name_");var u=VIRTUAL_PRODUCT_TREE_QUESTIONS.find(e=>e.QUESTION_ID==t[n].QUESTION_ID);t[n].PRODUCT_NAME;u=null!=u?"<span style='color:var(--danger)'>("+u.QUESTION+")</span>":"",o.innerHTML=t[n].PRODUCT_NAME+" "+u,r.setAttribute("data-product_id",t[n].PRODUCT_ID),r.setAttribute("data-stock_id",t[n].STOCK_ID),r.setAttribute("data-IS_VIRTUAL",t[n].IS_VIRTUAL),d.setAttribute("data-IS_VIRTUAL",t[n].IS_VIRTUAL),r.setAttribute("data-PRODUCT_TREE_ID",t[n].PRODUCT_TREE_ID),r.setAttribute("data-question_id",t[n].QUESTION_ID),r.setAttribute("data-idb",idB),idB++;var l=document.createElement("div"),s=buttonCreator("","btn btn-outline-success","onclick","getitem(this)","+"),c=buttonCreator("","btn btn-outline-danger","onclick","remItem(this)","-"),p=inputCreator("text","amount","onchange","MaliyetHesapla();","form-control form-control-sm","width:33%",t[n].AMOUNT);l.setAttribute("style","display:flex;align-items:baseline;float:right;margin-left:auto;justify-content: flex-end");var m=buttonCreator("","btn btn-outline-primary","onclick","setQuestion(this)","Q");"OFF"==i&&1!=t[n].IS_VIRTUAL&&(p.setAttribute("readonly","true"),s.setAttribute("disabled","true"),c.setAttribute("disabled","true"),m.setAttribute("disabled","true")),l.appendChild(p),l.appendChild(s),l.appendChild(m),l.appendChild(c);var b=document.createElement("div");b.setAttribute("style","display:flex"),b.appendChild(o),b.appendChild(l),r.appendChild(b),r.setAttribute("class","list-group-item"),t[n].AGAC.length>0&&r.appendChild(AgaciYaz_12(t[n].AGAC,t[n].RNDM_ID,a,t[n].IS_VIRTUAL)),d.appendChild(r)}return d}function UrunKaydet(){var t=SonAgac[SonAgac.length-1],e=$("#pnamemain").val(),a=$("#vp_id").val(),n=$("#is_virtual").val(),r=$("#project_id").val(),i=$("#pstage").val(),d={PRODUCT_NAME:e,PRODUCT_ID:a,IS_VIRTUAL:n,PROJECT_ID:r,PRODUCT_STAGE:i,PRODUCT_TREE:t};if(d){var o=document.createElement("form");o.target="Map",o.method="POST",o.action="/index.cfm?fuseaction=project.emptypopup_query_save_project_product";var u=document.createElement("input");u.type="hidden",u.name="data",u.value=JSON.stringify(d),o.appendChild(u),document.body.appendChild(o),map=window.open("/index.cfm?fuseaction=project.emptypopup_query_save_project_product","Map","status=0,title=0,height=600,width=800,scrollbars=1"),map?o.submit():alert("You must allow popups for this map to work.")}}function setQuestion(t){var e=t.parentElement.parentElement.parentElement,a=e.getAttribute("data-idb");openBoxDraggable("index.cfm?fuseaction=project.emptypopup_mini_tools&tool_type=alternativeQuestion&idb="+a)}function setAQuestions(t,e,a,n){var r=document.getElementByIdb(t);r.setAttribute("data-question_id",e);var i=$(r).find("span[name='product_name_']")[0],d=document.createElement("span");d.innerText="("+n+")",d.setAttribute("style","color:var(--danger)"),i.appendChild(d),closeBoxDraggable(a)}function MaliyetHesapla(){var t=0,e=$("#ppidarea *li");e.each(function(e,a){var n=$(a).find("input[name='amount']").val(),r=a.getAttribute("data-price"),i=a.getAttribute("data-other_money"),d=a.getAttribute("data-discount");null!=r&&0!=r.length||(r=0),null!=i&&0!=i.trim().length||(i="TL"),null!=d&&0!=d.length||(d=0),r=parseFloat(r),d=parseFloat(d),n=parseFloat(n);var o=moneyArr[moneyArr.findIndex(t=>t.MONEY==i)].RATE2;o=parseFloat(o);var u=r-r*d/100,l=u*o*n;t+=l});var a=commaSplit(t);$("#maliyet").val(a)}function GercekKontrol(t){var e=wrk_query("SELECT IS_CONVERT_REAL FROM VIRTUAL_PRODUCTS_PRT WHERE VIRTUAL_PRODUCT_ID="+t,"dsn3");console.log(e.IS_CONVERT_REAL[0]);var a=e.IS_CONVERT_REAL[0];if(a=parseInt(a),console.log(a),1==a){var n=document.getElementById("teklifButton");n.removeAttribute("class"),n.setAttribute("class","btn btn-outline-warning"),n.innerText="Teklife Dönüştü",n.setAttribute("disabled","disabled")}else{n=document.getElementById("teklifButton");n.removeAttribute("class"),n.setAttribute("class","btn btn-outline-secondary"),n.innerText="Teklif Ver",n.removeAttribute("disabled")}}function updateStage(t,e){var a=document.getElementById("vp_id").value;$.ajax({url:"/AddOns/Partner/project/cfc/product_design.cfc?method=updateStage&vp_id="+a+"&psatge="+t.value+"&ddsn3=workcube_metosan_1",success:function(t){getProjectProducts(e)}})}function getProjectProducts(t){$.ajax({url:"/AddOns/Partner/project/cfc/product_design.cfc?method=getProjectProducts&PROJECT_ID="+t+"&ddsn3=workcube_metosan_1",success:function(t){$("#leftMenuProject").html(t)}})}function addToCurrentTree(t,e){AddRowItemVirtual(t,e,"",0,0,0,"TL",0,0,0,0)}function convertToOffer(){var t=document.getElementById("maliyet").value,e=_compId,a=_priceCatId,n=document.getElementById("vp_id").value,r=document.getElementById("project_id").value;t=filterNum(t);var i="select PROJECT_NUMBER+'-'+PROJECT_HEAD as PROJECT_HEAD from workcube_metosan.PRO_PROJECTS where PROJECT_ID="+r,d=wrk_query(i,"dsn"),o=d.PROJECT_HEAD[0],u=$("#ppidarea *li"),l=new Array;for(let t=0;t<u.length;t++){var s=u[t],c=$(s.firstChild).find("span[name='product_name_']").text(),p=$(s.firstChild.lastChild).find("input[name='amount']").val(),m=s.getAttribute("data-product_id"),b=s.getAttribute("data-is_virtual"),A=s.getAttribute("data-price"),_=s.getAttribute("data-money"),g=s.getAttribute("data-discount"),C=getsettingByName("is_show_tree").paramValue,h={product_id:m,isVirtual:b,price:A,money:_,discount:g,productName:c,amount:p};l.push(h)}var v={Maliyet:t,company_id:e,price_catid:a,vp_id:n,project_id:r,project_name:o,stock_id:0,is_show_tree:C,ProductList:l},f=document.createElement("form");f.target="Map",f.method="POST",f.action="/index.cfm?fuseaction=sales.list_pbs_offer&event=add&act=convert";var E=document.createElement("input");E.type="hidden",E.name="data",E.value=JSON.stringify(v),f.appendChild(E),document.body.appendChild(f),map=window.open("/index.cfm?fuseaction=sales.list_pbs_offer&event=add&act=convert","Map","status=0,title=0,height=600,width=800,scrollbars=1"),map?f.submit():alert("You must allow popups for this map to work.")}function getsettingByName(t){for(let e=0;e<ProductDesingSetting.length;e++)if(ProductDesingSetting[e].paramName==t)return{paramValue:ProductDesingSetting[e].paramValue,indx:e}}function setSettings(t){var e=t.getAttribute("data-paramName"),a=t.getAttribute("data-paramValue");console.log(e,a);var n="OFF";n="OFF"==a?"ON":"OFF",console.log(n),t.setAttribute("data-paramValue",n);var r=getsettingByName(e).indx;ProductDesingSetting[r].paramValue=n,$.ajax({url:"/AddOns/Partner/project/cfc/product_design.cfc?method=updateSettings&paramName="+e+"&paramValue="+n+"&ddsn3=workcube_metosan_1",success:function(t){console.log(t),LoadSettings()}})}var o=new Object,ulx=document.createElement("div");ulx.setAttribute("id","ppidarea");var sonEleman="",_compId,_priceCatId,SonAgac=new Array,idA=1e3,isUpdated=!1,idB=5e3;$(document).ready(function(){var t=document.getElementById("wrk_main_layout");t.removeAttribute("class"),t.setAttribute("class","container-fluid"),LoadSettings();var e=getParameterByName("project_id"),a=wrk_query("select COMPANY_ID FROM PRO_PROJECTS WHERE PROJECT_ID="+e,"DSN").COMPANY_ID[0];let n=GetAjaxQuery("CompanyInfo",a);_priceCatId=n.PRICE_LISTS.find(t=>1==t.IS_DEFAULT).PRICE_CATID,_compId=a}),document.getElementByIdb=function(t){var e=t.toString(),a=$("*").find("* [data-idb='"+e+"']")[0];return a};